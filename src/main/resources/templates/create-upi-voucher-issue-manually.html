<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Create UPI Voucher Issuance - Issue Manually</title>

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="css/slick/slick-theme.css" />
	<script type="text/javascript" src="js/xsls-export.js"></script>
    <link rel="stylesheet" href="css/custom.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

</head>


<body id="page-top" onload="getLinkedBankDetail(),getVoucherListWithIcon()" >
<!--	<body id="page-top" onload="getLinkedBankDetail(),getVoucherListWithIcon(),getTotalVoucherCount(),getVoucherSummaryList()" >-->
 <div class="bs-canvas-overlay bg-dark position-fixed w-100 h-100"></div>

    <!-- Page Wrapper -->
    <div id="wrapper">

	<!-- Sidebar -->
					      
	 <div th:insert="fragments/sidenav.html :: sidevav"></div>
	
	 <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

				<!-- Topbar -->
				              

<nav class="navbar navbar-expand navbar-light bg-white topbar static-top">

                   <!-- Topbar Navbar -->
                   <ul class="navbar-nav top-nav">

                       <!-- Nav Item - User Information -->
                     <!--  <li class="nav-item">
                           <a class="nav-link active" href="#">
                               <span class="mr-2 small">Dashboard</span>
                               <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                           </a>
                       </li>
                       <li class="nav-item">
                           <a class="nav-link" href="#">
                               <span class="mr-2 small">Employee Payroll</span>
                               <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                           </a>
                       </li>-->

                   </ul>

				   <!-- Right Icons + Profile -->
				   			    <ul class="navbar-nav d-flex flex-row align-items-center mb-0">
				   			      <!-- Wallet Icon -->
				   			     <!-- <li class="nav-item mr-3">
				   			        <a href="/settings/wallet" role="button">
				   			          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
				   			        </a>
				   			      </li>-->
				   				  <li class="nav-item mr-3">
				     			        <a href="/cotowallet" role="button">
				     			          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
				     			        </a>
				     			      </li>
				   			      <!-- Notification Icon -->
				   			      <li class="nav-item mr-3">
				   			        <a href="#" role="button">
				   			          <img src="img/Notification-icon.png" alt="Notification" class="nav-icon-img">
				   			        </a>
				   			      </li>

				   			      <!-- Profile Dropdown -->
				   			      <li class="nav-item dropdown no-arrow">
				   			        <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				   			          <img class="img-profile rounded-circle" src="img/undraw_profile.svg" alt="User" style="width: 32px; height: 32px;">
				   			        </a>
				   			        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
				   			          <a class="dropdown-item" href="/ProfileInfo">
				   			            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Profile
				   			          </a>
				   			       <!--   <a class="dropdown-item" href="#">
				   			            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> Settings
				   			          </a>-->
				   			          <div class="dropdown-divider"></div>
				   			          <a class="dropdown-item" th:href="@{/logout}">
				   			            <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout
				   			          </a>
				   			        </div>
				   			      </li>
				   			    </ul>		
           </nav>
  <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid p-0 p-md-1">
                    <div class="row">
                        <div class="col-12">
                            <div class="tab-content">
                                <div class="upi-voucher-wrap">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <h3 class="mb-0">UPI Voucher Issuance </h3>
                                    </div>
                                    <div class="col-12 col-md-8 mx-auto">
                                        <div class="breadcrumb-wrap">
                                            <div class="breadcrumb-in active">
                                                <span>1</span>
                                                <label>Enter Voucher Details</label>
                                            </div>
                                            <div class="breadcrumb-in"  id="lable2">
                                                <span>2</span>
                                                <label>Authenticate Issuance</label>
                                            </div>
                                            <div class="breadcrumb-in" id="lable3">
                                                <span>3</span>
                                                <label>Vouchers Issued</label>
                                            </div>
                                        </div>
                                    </div>
										
                                </div>
                            </div>

							
                            <div class="selectvouchers-update">
                                <p>Last updated on</p>
                                <span th:text="${session.formattedDate}" ></span>
                            </div>

                            <div class="selectvouchers-top">
                                <div class="selectvouchers-topleft">
                                    <div class="selectvouchers-topleft-cards">
										

                                      <!--  <div class="selectvouchers-topleft-cardsdiv">
                                            <div class="INDIANB-NS-wrapper"><img class="INDIANB-NS"
                                                    src="img/indianbank.png" width="16px"></div>
                                            <div class="text-wrapper">Indian Bank</div>
                                            <div class="xxxx">xxxx3456</div>
                                            <img class="dropdown" src="img/arrowdown.svg" width="16px">
                                        </div>-->
										<!-- Hidden original select -->
										<select id="banklist" style="display:none"></select>

										<div class="custom-dropdown" id="customDropdown">
										  <div id="selectedBank" style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;">
										    <span>Select Bank</span>
										    <span style="margin-left: 8px;">&#9662;</span> <!-- ▼ Unicode dropdown arrow -->
										  </div>
										  <div class="dropdown-list" id="dropdownList"></div>
										</div>
										 <button class="button-check-balance mt-2" style="display: none;" >Check Balance</button>
										 <div class="tip-disabled mt-2" style="display: none;" >
										     <img src="img/info.svg" alt="info icon">
										     Check availability of funds to issue vouchers!
										 </div>
										 
										 <div class="div-2 mt-5" style="text-align: right; margin-top: 20px !important;">
										   <p class="element" style="display: inline-flex; align-items: center; justify-content: flex-end; margin: 0; gap: 2px;">
										     <span class="span" style="font-size: 20px;">₹</span>
										     <span class="text-wrapper-3" style="font-size: 20px;">1,23,456</span>
										   </p>
										 </div>
                                        <p class="last-updated-on"><!--<span th:text="${session.formattedDate}" ></span>-->
											Available Balance
											</p>
										 
                                    </div>
									<div class="selectvouchers-topleft-cards selectvouchers-topleft-primary">
										
                                       <h5>Total Vouchers</h5>
                                       <div class="d-flex justify-content-between my-1 mb-3">
                                           <span>Number</span>
                                        <!--   <span id="totalNumber"></span>--> 
										   <span id="totalRowCount">0</span>
										   <input type="hidden" name="totalRowCountHidden" id="totalRowCountHidden" >
                                       </div>
                                       <div class="d-flex justify-content-between my-1">
                                           <span>Value</span>
                                          <!-- <span id="totalValue"></span>-->
										   <span id="totalAmount">₹0.00</span>
										   <input type="hidden" name="totalAmountHidden" id="totalAmountHidden" >
                                       </div>
                                   </div>
                                </div>
								
							<!--  <div class="selectvouchers-topright">
		                              <div class="selectvouchers-carosel responsive-content-demo" >
		                                 <div id="jsonData" class="demo-slider"></div>
		                                  
		                              </div>
		                          </div>-->
								  
                            </div>

                            <div class="upi-voucher-wrap selectvouchers-bottom" id="selectvouchers-wrap03">
                                <div class="d-flex">
                                    <h3>Enter Details </h3>
                                </div>

                                <div>
                                    <p>Please input the details for the issuance of vouchers.</p>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-reimbursements selectvouchers-table" id="sourceTable">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Mobile Number</th>
                                                <th>Voucher Type</th>
                                                <th>Redemption Type</th>
                                                <th>Amount</th>
                                                <th>Start Date</th>
                                                <th>Validity</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="voucherTableBody">
                                           <tr>
                                                <td>
                                                    <div class="autocomp-input-wrap table-input">
                                                        <input type="text" class="autocomp-input" id="search" oninput="userSearchAndPopulate(this)"
                                                            placeholder="Enter Name" autocomplete="off">
                                                        <div id="autocomplete-suggestions" class="autocomplete-dropdown">
															
														</div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="text" class="table-input" maxlength="10" readonly
													 oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                                                     placeholder="Enter Mobile Number">
													 
                                                </td>
                                                <td>
                                                    <input type="text" class="table-input table-input-voucher" onclick="showVoucherModal(this)"
                                                     placeholder="Select Voucher">  
													 <input type="hidden" class="table-input table-input-voucher selectMCC"> 
													 <input type="hidden" class="table-input table-input-voucher selectPurpose"> 
													 <input type="hidden" class="table-input table-input-voucher selectMCCDescription"> 
													 <input type="hidden" class="table-input table-input-voucher selectPurposeDescription">   
                                                </td>
                                                <td>
                                                    <select class="GeneralSelect redemptionType">
                                                        <option value="Single">Single</option>
                                                        <option value="MULTIPLE" selected>Multiple</option>
                                                    </select>
                                                </td>
												<td>
												  <input type="text" 
												         class="table-input amount" 
												         placeholder="Enter Amount" 
												         id="amount" 
												         maxlength="6"
												         oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1'); validateAmount();">
												</td>
                                                <td>
                                                    <div>
                                                        <input type="date" class="table-input table-dateed" placeholder="Salect Date" onclick="this.showPicker()" readonly>
                                                    </div>
                                                </td>
                                                <!--<td>
                                                    <select class="GeneralSelect validity">
														<option value="1 Days" class="test">2 Day </option>
                                                        <option value="7 Days" class="test">7 Days </option>
                                                        <option value="30 Days">30 Days</option>
                                                        <option value="90 Days">90 Days</option>
														<option value="365 Days">365 Days</option>
														
                                                    </select>
                                                </td>-->
												<td>
												  <div style="position: relative;">
												    <input type="number"
												           class="table-input validity-input"
												           placeholder="2 - 365"
												           min="2"
												           max="365"
												           oninput="appendDaysSuffix(this)"
												           style="padding-right: 10px; box-sizing: border-box;">

												    <!-- Days label -->
												    <span style="
												      position: absolute;
												      right: 32px;       /* Moves Days left of spinner */
												      top: 50%;
												      transform: translateY(-50%);
												      pointer-events: none;
												      color: #555;
												      font-size: 14px;
												    ">Days</span>
												  </div>
												</td>
                                                <td>
                                                    <a href="#" onclick="deleteRow(this)"><img src="img/delete.svg" alt=""></a>
                                                </td>
                                            </tr>
											<!--<tr>
                                           <td>
											  <div class="error-msg" id="beneficiaryNameError" style="color:red"></div>
										   </td>
										   <td>
											<div class="error-msg" id="beneficiaryMobileError" style="color:red"></div>

                                            </td>
                                           <td>
											<div class="error-msg" id="voucherError" style="color:red"></div>

                                           </td>
                                           <td>
											<div class="error-msg" id="redemptionTypeError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="amountError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="startDateError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="expiryDateError" style="color:red"></div>
                                           </td>
                                           <td>
											
                                           </td>

                                       </tr>
                                       <tr class="text-center">
                                                <td colspan="8" style="background: #EAF4EF;">
                                                    <a href="#" class="text-success" onclick="addNewVoucher(event)">+ Add New Voucher</a>
                                                </td>
                                            </tr>
                                       </tr>-->
									 
                                        </tbody>
										<tr class="text-center">
										  <td colspan="8" style="background: #EAF4EF; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
										    <a href="#" style="color: #2F945A; font-weight: 700;" onclick="addNewVoucher(event)">+ Add New Voucher</a>
										  </td>
										</tr>
                                    </table>
									<div id="common-error-msg" style="color: #F24822; display: none;"></div>
                                </div>

                                <div class="w-100 my-3 text-right">
                                    <button class="btn btn-border-primary"
                                        onclick="window.location.href='/upiVoucherIssuanceNew';">Back</button>
                                    <button type="button" class="btn btn-primary"id="continueButton1" onclick="singleVoucherValidation()">Continue</button>
                                </div>								
                            </div>

							<div class="upi-voucher-wrap selectvouchers-bottom" id="selectvouchers-wrap04" style="display: none;">
	                                <div class="d-flex">
	                                    <h3>Verify Details </h3>
	                                </div>
	                                <div>
	                                    <p>Please Verify the details for the issuance of vouchers.</p>
	                                </div>

	                                <div class="table-responsive">
	                                    <table class="table table-reimbursements selectvouchers-table" id="targetTable">
	                                        <thead>
	                                            <tr>
	                                                <th>Name</th>
	                                                <th>Mobile</th>
	                                                <th>Voucher Type</th>
	                                                <th>Redemption Type</th>
	                                                <th>Amount</th>
	                                                <th>Start Date</th>
	                                                <th>Validity</th>
	                                            </tr>
	                                        </thead>
												<tbody>
	                                                <tr>
	                                                    <td><span id="namelbl"></span></td>
														<td><span id="mobilelbl"></span></td>
	                                                    <td><span id="voucherlbl"></span></td>
	                                                    <td><span id="redemptionLbl"></span></td>
														<!--<td><span id="vmcclbl"></span></td>-->
	                                                    <td><span id="amountlbl"></span></td>
	                                                    <td><span id="startdatelbl"></span></td>
	                                                    <td><span id="validitylbl"></span></td>
	                                                           
	                                                </tr>
	                                               
	                                            </tbody>
	                                    </table>
	                                </div>
									<div class="form-group mt-3">
                                       <div class="custom-control custom-checkbox small">
                                           <input type="checkbox" class="custom-control-input" id="customCheck45" onchange="toggleSubmitButton()">
                                           <label class="custom-control-label text-left" for="customCheck45">I confirm
                                               that the details uploaded above are correct to the best of my knowledge,
                                               and are approved by the competent authority in my organization.</label>
                                       </div>
									<div class="error-msg" id="errorMessage" style="color:red"></div>
                                   </div>

								   <div class="clearfix"></div>
								   <div id="issuemsgdiv" style="display:none" class="alert alert-success text-center">
								   	<div id="issuesuccmsg"></div>   
								   </div>
								   <div id="issuesfailmsgDiv" style="display:none" class="alert alert-danger text-center">
								   	<div id="issuesfailmsg"></div>
								   </div>	
								   
	                                <div class="w-100 my-3 text-right">
	                                    <button class="btn btn-border-primary" id="verifyDetailBack">Back</button>
	                                    <button class="btn btn-primary" id="submitButton"  disabled >Issue Voucher</button>
	                                </div> 
									<input type="hidden" class="form-input" id="employerMobile" name="employerMobile" th:value="${session.mobile}"> 
									<input type="hidden" class="form-input" id="employerId" name="employerId" th:value="${session.id}"> 
									<input type="hidden" class="form-input" id="employerName" name="employerName" th:value="${session.username}"> 
									<input type="hidden" class="form-input" id="voucherId" name="voucherId"> 
									<input type="hidden" class="form-input" id="voucherCode" name="voucherCode"> 
									<input type="hidden" class="form-input" id="voucherType" name="voucherType"> 
									<input type="hidden" class="form-input" id="voucherSubType" name="voucherSubType"> 
									<input type="hidden" class="form-input" id="voucherDesc" name="voucherDesc"> 
									<input type="hidden" class="form-input" id="purposeCode" name="purposeCode"> 
									<input type="hidden" class="form-input" id="purposeName" name="purposeName"> 
									<input type="hidden" class="form-input" id="activeStatus" name="activeStatus"> 
									<input type="hidden" class="form-input" id="createdby" name="createdby"> 
									<input type="hidden" class="form-input" id="bankName" name="bankName"> 
									<input type="hidden" class="form-input" id="accountSeltWallet" name="accountSeltWallet"> 
									<input type="hidden" class="form-input" id="bankcode" name="bankcode"> 
									<input type="hidden" class="form-input" id="accountHolderName" name="accountHolderName"> 
									<input type="hidden" class="form-input" id="acNumber" name="acNumber">
									<input type="hidden" class="form-input" id="accountType" name="accountType"> 
									<input type="hidden" class="form-input" id="ifsc" name="ifsc">
									
									<input type="hidden" class="form-input" id="erupiFlag" name="erupiFlag"> 
									<input type="hidden" class="form-input" id="branchCode" name="branchCode"> 
									<input type="hidden" class="form-input" id="authStatus" name="authStatus">
									
									<input type="hidden" class="form-input" id="authResponse" name="authResponse">
									<input type="hidden" class="form-input" id="banklinkedMobile" name="mobile"> 
									<input type="hidden" class="form-input" id="accstatus" name="accstatus"> 
									
									<input type="hidden" class="form-input" id="orgId" name="orgId"> 
									<input type="hidden" class="form-input" id="orgCode" name="orgCode"> 
									<input type="hidden" class="form-input" id="tid" name="tid"> 
									<input type="hidden" class="form-input" id="merchentIid" name="merchentIid"> 
									<input type="hidden" class="form-input" id="mcc" name="mcc"> 
									<input type="hidden" class="form-input" id="submurchentid" name="submurchentid"> 
									<input type="hidden" class="form-input" id="merchentid" name="merchentid">
									<input type="hidden" class="form-input" id="payerva" name="payerva"> 													
	                        </div>
							
							<div class="upi-voucher-wrap" id="upi-voucher-wrapThree" style="display: none;">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h3>Report for Voucher Issuance</h3>
                                        <p>Please cross-check the details for the issuance of vouchers. </p>
                                    </div>
                                    <div class="rightdownload mb-3">
                                        <button class="download-vc" id="downloadBtn">
                                            <img src="img/download-vouchers.svg" alt="">
                                        </button>
                                    </div>
                                </div>
                                <hr>

								<div class="table-responsive">
						        <table class="table table-reimbursements selectvouchers-table" id="successFailVoucherTable">
						            <thead>
						                <tr>
						                    <th>Name</th>
						                    <th>Mobile Number</th>
						                    <th>Voucher Type</th>
						                    <th>Redemption Type</th>
						                    <th>Amount</th>
						                    <th>Start Date</th>
						                    <th>Validity</th>
						                    <th>Status</th>
						                    <th></th>
						                </tr>
						            </thead>
						            <tbody>
						                
						            </tbody>
						        </table>
						    </div>
                      
                                <div class="row">
                                    <div class="col-12 text-right my-3">
                                        <a th:href="@{/upiVoucherIssuanceNew}" class="btn btn-primary mb-1">GO TO DASHBOARD</a>
                                    </div>
                                </div>


                            </div>
							
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->
        </div>
		

		<div class="lds-spinner" id="signinLoader" style="display: none">
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
		</div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

	<!-- Bootstrap core JavaScript-->
	  <script src="vendor/jquery/jquery.min.js"></script>
	  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	  <!-- Core plugin JavaScript-->
	  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

	  <!-- Custom scripts for all pages-->
	  <script src="js/sb-admin-2.min.js"></script>

	  <!-- Page level plugins -->
	  <script src="vendor/datatables/jquery.dataTables.min.js"></script>
	  <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

	  <!-- Page level custom scripts -->
	  <script src="js/demo/datatables-demo.js"></script>

	  <!-- <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script> -->
	  <script type="text/javascript" src="js/slick/slick.min.js"></script>

	<script type="text/javascript" src="cotodel-js/create-upi-voucher-issuance.js"></script>
	<script type="text/javascript" src="cotodel-js/sanitize-input.js"></script>
	<script type="text/javascript" src="cotodel-js/single-voucher-creation.js"></script>
	<script>
		/*function appendDaysSuffix(input) {
		    let num = parseInt(input.value);
		    if (!isNaN(num)) {
		        if (num < 2) num = 2;
		        if (num > 365) num = 365;
		        input.value = num; // only number in UI field
		        input.setAttribute('data-validity', num + ' Days'); // hidden value for API
		    } else {
		        input.removeAttribute('data-validity');
		    }
		}*/
		function appendDaysSuffix(input) {
		    const value = parseInt(input.value, 10);
		 
		    if (isNaN(value)) return;
		 
		    if (value < 2 || value > 365) {
		        input.setCustomValidity("Please enter a number between 2 and 365.");
		        input.reportValidity();
		    } else {
		        input.setCustomValidity("");
		    }
		}

	</script>

	<script>
        //var today = new Date().toISOString().split('T')[0];
       // document.getElementById("startDate").value = today;
    </script>

	<script>
		/*window.addEventListener('DOMContentLoaded', function () {
		    const today = new Date().toISOString().split("T")[0];
		    document.querySelectorAll('.table-dateed').forEach(function(dateInput) {
		        dateInput.setAttribute("min", today);
		    });
		});*/
		window.addEventListener('DOMContentLoaded', function () {
		  const today = new Date().toISOString().split("T")[0];

		  document.querySelectorAll('.table-dateed').forEach(function (dateInput) {
		    dateInput.setAttribute("min", today);
		    dateInput.value = today;
		  });
		});

		</script>
		
	<style>	/* Wrap input to allow absolute positioning of dropdown */
		.selectvouchers-table{
			overflow: auto !important;
		}

	
</style>

	<style>	
		 
		.selectvouchers-topleft-cards {
		    position: relative;
		}
		.custom-dropdown {
		  position: relative;
		  width: 340px;
		  border: 1px solid #EDEDF0;
		  border-radius: 10px;
		  background: white;
		  color: #1F212C;
		  cursor: pointer;
		  padding: 10px;
		}
		.dropdown-item {
		  display: flex;
		  justify-content: space-between;
		  align-items: center;
		  padding: 8px;
		  
		}
		.dropdown-item img {
		  width: 24px;
		  margin-right: 10px;
		}
		.dropdown-bank-info {
		  display: flex;
		  align-items: center;
		}
		.dropdown-mask {
		  margin-left: auto;
		  color: #666;
		  font-weight: 500;
		}
		.dropdown-list {
		  position: absolute;
		  width: 100%;
		  background: white;
		  border: 1px solid #EDEDF0;
		  z-index: 10;
		  display: none;
		  max-height: 200px;
		  overflow-y: auto;
		  border-radius: 10px;
		}

</style>
	<style>	.selectvouchers-table {
	  border-collapse: separate !important;
	  border-spacing: 0 !important;
	  border: 1px solid #dee2e6; /* optional: your table border */
	  border-radius: 10px; /* visible if no container hides it */
	  overflow: hidden; /* clip overflow if needed */
	}
	.selectvouchers-table tr:last-child td {
	  border-bottom-left-radius: 10px;
	  border-bottom-right-radius: 10px;
	}
</style>
			
	<style>	@keyframes rotate360 {
	    from {
	        transform: rotate(360deg);
	    }
	    to {
	        transform: rotate(0deg);
	    }
	}

	.rotate {
	    animation: rotate360 0.6s linear; /* 0.6s for a smooth rotation */
	} </style>
	<script>
		
		document.getElementById("recallBalance").addEventListener("click", function() {
	    var recallIcon = this;
	    var selectedBankAccount = document.getElementById("banklist").value;

	    // Add rotation class
	    recallIcon.classList.add("rotate");

	    // Remove rotation class after animation completes (so it can be retriggered)
	    setTimeout(() => {
	        recallIcon.classList.remove("rotate");
	    }, 600); // Match the animation duration

	    // Call the function to refresh balance if a bank is selected
	    if (selectedBankAccount) {
	        showLinkedAccAmount(selectedBankAccount);
	    } else {
	        alert("Please select a bank account first.");
	    }
	});

</script>
		
	<script>
			$('.responsive-content').slick({
            dots: false,
            infinite: false,
            speed: 300,
            slidesToShow: 4,
            slidesToScroll: 1,
            draggable: false,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 1,
                        infinite: true
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1
                    }
                }
            ]
        });
		</script>
	<script type="text/javascript">

	$(document).ready(function(){
		
		  $('li.active').removeClass('active').removeAttr('aria-current'); 
		  $('a[href="' +'/upiVoucherIssuanceNew"]').closest('li').addClass('active').attr('aria-current', 'page');   
		  
	   $(".innernav").click(function(){
	       $(".dropdownNav").addClass("active");
	   });
	});

	</script>
	<script>
	  $(document).ready(function() {
	    $('#submitButton').click(function() {
	      // Call the AJAX function
		  document.getElementById('submitButton').disabled=true;
		  const checkbox = document.getElementById('customCheck45');
	  		 const errorMessage = document.getElementById('errorMessage');
	  		 if (checkbox.checked) {
	  		    errorMessage.textContent = "";
	  		  } else {
	  		    errorMessage.textContent = "Please check consent"; 
	  			return false;
	  		  }
	  		
		  var employerMobile = document.getElementById("employerMobile").value;
		  var rowcount = parseInt(document.getElementById("totalRowCount").innerHTML);

		  document.getElementById("authenticate").disabled = false;
	      $.ajax({
	        url:"/smsOtpWithTemplateMobileAndAmount",
	        type: 'POST',
			data: {
						"mobile": employerMobile,
						"template": "OTP Number Vouchers Issuance",
						"value": rowcount,
					},
			dataType: 'json',
			success: function(data) {
			var obj = data;
	        if (obj.status=== true) {
				// Mask the mobile number (show only last 4 digits)
				var maskedMobile = "XXXXXX" + employerMobile.toString().slice(-4);
				document.getElementById("maskedMobileDisplay").innerText = `OTP code has been sent to your phone ${maskedMobile}. Enter OTP to validate issuance.`;				
				
	            // If successful, open the OTP modal
				var timeleft = "60";
				var resendCodeElement = document.getElementById("resendCode");
	               // Hide the "Resend OTP" link initially
	               resendCodeElement.style.display = "none";
				var downloadTimer = setInterval(function() {
					document.getElementById("countdown").innerHTML = "00:"+timeleft;
					timeleft -= 1;
					document.getElementById("orderId").value= obj['orderId'];
					if (timeleft < 0) {
						clearInterval(downloadTimer);
						resendCodeElement.style.display = "block";
						document.getElementById("authenticate").disabled = true;
					}
								}, 1000);
	            $('#otpModal1').fadeIn();
	          } else {
				document.getElementById('submitButton').disabled=false;
	            alert("Error: " + response.message);
	          }
	        },
	        error: function() {
			  //$('#otpModal').fadeIn();
	         // alert("An error occurred. Please try again.");
	        }
	      });
	    });

	    // Close the modal when clicking outside the modal content
	    $(window).on('click', function(event) {
	      if (event.target.id === 'otpModal') {
	        $('#otpModal').fadeOut();
	      }
	    });
	  });
	  
	  
	</script>
	
    <script>
        $(document).ready(function () {
            $("#linkBankAccount").click(function () {
                $("#linkedAccount").show();
                $("#nolinkBankAccount").hide();

            });
        });
        $(document).ready(function () {

            $("#selectvouchers").click(function () {
                $("#selectvouchers-wrap02").show();
                $("#selectvouchers-wrap01").hide();
            });

            $("#authenticatereport").click(function () {
                $("#selectvouchers-wrap05").show();
                $(".modal").hide();
                $("#selectvouchers-wrap04").hide();
            });
			
			$("#verifyDetailBack").click(function () {
			    $("#selectvouchers-wrap03").show();
			    $("#selectvouchers-wrap04").hide();
			});
					

            $(".selectMCC").click(function () {
                $("#modalforvccategoryforbulkissuance").show();
            });
        });

        $(document).ready(function () {
            $('.vouchers-checkbox1').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers1').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers1').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox2').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers2').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers2').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox3').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers3').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers3').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox4').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers4').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers4').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox5').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers5').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers5').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox6').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers6').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers6').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox7').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers7').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers7').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox8').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers8').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers8').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox9').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers9').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers9').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox10').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers10').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers10').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox11').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers11').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers11').removeClass('highlight'); // Remove class when unchecked
                }
            });

            $('.vouchers-checkbox12').change(function () {
                if ($(this).is(':checked')) {
                    $('.cards-upivouchers12').addClass('highlight'); // Add class when checked
                } else {
                    $('.cards-upivouchers12').removeClass('highlight'); // Remove class when unchecked
                }
            });

        });

        ////////////////////////
       
    </script>
<style>	/* Top box categories */
	/* Page root optional cleanup */
	body {
	    margin: 0;
	    padding: 0;
	    box-sizing: border-box;
	    font-family: Arial, sans-serif;
	}

	/* Parent container */
	/* Parent container */
	#voucherList {
	    width: 100%;
	    max-width: 1200px;
	    padding-left: 16px;
	    padding-right: 16px;
	    margin: 0 auto;
	    box-sizing: border-box;
	   /* overflow-y: scroll;*/
	    height: 400px;

	 /*   scrollbar-width: thin;*/
	  /*  scrollbar-color: #2F945A #EAF4EF;*/
	}

	#voucherList::-webkit-scrollbar {
	    width: 8px;
	}

	#voucherList::-webkit-scrollbar-track {
	    background: #EAF4EF;
	    border-radius: 8px;
	}

	#voucherList::-webkit-scrollbar-thumb {
	    background-color: #2F945A;
	    border-radius: 8px;
	    border: 2px solid #EAF4EF;
	}

	/* Top box categories */
	.top-categories-box {
	    background-color: #EAF4EF;
	    padding: 20px;
	    border-radius: 20px;
	    list-style: none;
	    width: 100%;
	    max-width: 600px; /* optional to control max width of the box */
	    margin: 10px auto;
	    box-sizing: border-box;
	}

	/* Section title */
	#voucherList h5 {
	    color: #1F212C;
	    margin: 10px 0;
	    font-size: 16px;
	    font-weight: 600;
	}

	/* Other categories list */
	.other-categories {
		margin-top: 10px;
	    list-style: none;
	    padding: 0;
	    margin: 0;
	    width: 100%;
	    max-width: 600px;
	    margin: 0 auto;
	    box-sizing: border-box;
	}

	/* List item */
	.voucher-item {
	    display: flex;
	    align-items: center;
	    gap: 12px;
	    padding: 8px 12px;
	    border-radius: 8px;
	    cursor: pointer;
	    transition: background-color 0.1s ease, color 0.1s ease;
	    width: 100%;
	    box-sizing: border-box;
	    background-color: transparent;
	    position: relative;
	    z-index: 1;
	}

	/* Hover effect */
	.voucher-item:hover {
	    background-color: #2F945A !important;
	    color: #FFFFFF !important;
	}

	.voucher-item:hover span {
	    color: #FFFFFF !important;
	}

	/* Selected item stays green */
	.voucher-item.selected {
	    background-color: #2F945A;
	    color: #FFFFFF;
	}

	.voucher-item.selected span {
	    color: #FFFFFF;
	}

	/* Image style */
	.voucher-item img {
	    height: 32px;
	    width: 32px;
	    flex-shrink: 0;
	}


</style>
	<script>
		/*function getVoucherListWithIcon() {
		    const voucherList = document.getElementById('voucherList');
		    const purposeList = document.getElementById('purposeList');

		    $.ajax({
		        type: "GET",
		        url: "/getVoucherListWithIcon",
		        success: function(data) {
		            const parsedData = jQuery.parseJSON(data);
		            console.log("Get voucher list with data : ", parsedData);

		            // Setup container with 2 lists
		            voucherList.innerHTML = `
		                <ul id="topCategories" class="top-categories-box"></ul>
		                <h5 style="
		                    color: #1F212C;
		                    margin: 16px 16px 10px 16px;
		                    font-size: 16px;
		                    font-weight: 600;
		                ">Other Categories</h5>
		                <ul id="otherCategories" class="other-categories"></ul>
		            `;

		            const topCategories = document.getElementById('topCategories');
		            const otherCategories = document.getElementById('otherCategories');

		            // Populate Voucher List
		            parsedData.data.forEach((item, index) => {
		                const li = document.createElement('li');
		                li.classList.add('voucher-item');
		                li.setAttribute('data-value', item.purposeCode);

		                const img = document.createElement('img');
		                img.src = item.voucherIcon
		                    ? `data:image/png;base64,${item.voucherIcon}`
		                    : '';
		                img.alt = item.voucherName;

		                const span = document.createElement('span');
		                span.textContent = item.voucherName;
		               
		                span.style.fontWeight = '500';

		                li.appendChild(img);
		                li.appendChild(span);

		                // Append to correct list
		                if (index < 5) {
		                    topCategories.appendChild(li);
		                } else {
		                    otherCategories.appendChild(li);
		                }
		            });

		            // Add click event listener to entire voucherList
		            voucherList.addEventListener('click', event => {
		                const clickedItem = event.target.closest('li.voucher-item');
		                if (clickedItem) {
		                    const purposeCode = clickedItem.getAttribute('data-value');
		                    const voucherIcon = clickedItem.querySelector('img').src;
		                    const voucherName = clickedItem.querySelector('span').textContent;

		                    // Clear selections
		                    [...voucherList.querySelectorAll('li.voucher-item')].forEach(item => item.classList.remove('selected'));
		                    [...purposeList.children].forEach(item => item.remove());
		                    // Highlight selected
		                    clickedItem.classList.add('selected');

		                    // Fetch Purpose List
		                    fetchPurposeListByVoucherCode(purposeCode);
		                }
		                document.getElementById("mccDiv").style.display = "block";
		            });
		        },
		        error: function(e) {
		            alert('Error: ' + e.responseText);
		        }
		    });
		}



	    function fetchPurposeListByVoucherCode(purposeCode) {
	        const purposeList = document.getElementById('purposeList');

	        $.ajax({
	            type: "GET",
	            url: "/getPurposeListByVoucherCode",
	            data: { purposeCode },
	            success: function(data) {
	                const parsedData = jQuery.parseJSON(data);
					console.log("fetchPurposeListByVoucherCode : ",parsedData);
	                // Populate Purpose List with radio buttons
					const imageElement = document.getElementById('voucherImageId');
					const textElement = document.getElementById('voucherTextId');

					
			       imageElement.src = parsedData.mccMainIcon.mccMainIcon
						                        ? `data:image/png;base64,${parsedData.mccMainIcon.mccMainIcon}`
						                        : 'img/fuelVouchers.svg'; // Set image
					textElement.textContent = parsedData.mccMainIcon.voucherName ? parsedData.mccMainIcon.voucherName : "";

	                parsedData.data.forEach(item => {
	                    const li = document.createElement('li');
	                    li.classList.add('purpose-item');
	                    li.setAttribute('data-value', item.mcc);

	                    // Create radio input
	                    const radioInput = document.createElement('input');
	                    radioInput.type = 'radio';
	                    radioInput.classList.add('voucher-radioinput');
	                    radioInput.name = 'selectvouchers'; // Group radio buttons by name

	                    // Create img element
	                    const img = document.createElement('img');
	                    img.src = item.mccIcon
	                        ? `data:image/png;base64,${item.mccIcon}`
	                        : '';
	                   // img.alt = item.mccDesc;
	                    img.classList.add('img-fluid');
						img.style.height = '20px';
						img.style.width = '20px';
	                    // Create span element with voucher name
	                    const span = document.createElement('span');
	                    span.textContent = item.mccDesc;

	                    // Append elements to li
	                    li.appendChild(radioInput);
	                    li.appendChild(img);
	                    li.appendChild(span);
	                    purposeList.appendChild(li);
	                });
	            },
	            error: function(e) {
	                alert('Error: ' + e.responseText);
	            }
	        });
	    }functionality without auto select*/
    // Initialize
   // getVoucherListWithIcon();
	</script>

	<script>
	
	//function getTotalVoucherCount(){
		//		var employerid = document.getElementById("employerId").value;
			//	$.ajax({
				//	type: "POST",
					//url: "/getTotalVoucherCount",
					//data: {
						//"orgId": employerid,
						//"workflowid":100003
					//},
					//success: function(data) {
						//newData = data;
						//var data1 = jQuery.parseJSON(newData);
						//document.getElementById("totalNumber").innerText=data1.totalCount;
						//document.getElementById("totalValue").innerText="₹"+data1.totalAmount;
						
					//	},
					//	error: function(e) {
						//	alert('Failed to fetch JSON data' + e);
					//}
				//});
		//	}
			
		function searchEmployee() {
	        const searchBox = document.getElementById('searchBox').value;
	        const employerId = document.getElementById('employerId').value;
			var userMobile = document.getElementById("userMobile").value;
	        // Show loader
	        document.getElementById("signinLoader").style.display = "flex";
			
	        $.ajax({
	            type: "POST",
	            url: "/userSearch",
	            dataType: 'json',
	            data: {
	                "orgId": employerId,
	                "userName": searchBox,
					"userMobile": userMobile
	            },
	            success: function (data) {
	                document.getElementById("signinLoader").style.display = "none";

	                if (data && data.status && data.data.length > 0) {
	                    const roleHeaders = generateHeaders(data.data);
	                    generateRows(data.data, roleHeaders);
	                } else {
	                    alert("No data found for the given search.");
	                }
	            },
	            error: function (e) {
	                document.getElementById("signinLoader").style.display = "none";
	                console.error('Error:', e);
	                alert('An error occurred while fetching the data.');
	            }
	        });
	    }
		
		
	</script>
	<script>
	    // Function to format date as YYYY-MM-DD
	    function getFormattedDate(offsetDays = 0) {
	        const date = new Date();
	        date.setDate(date.getDate() + offsetDays); // Adjust for offset days
	        const yyyy = date.getFullYear();
	        const mm = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
	        const dd = String(date.getDate()).padStart(2, '0');
	        return `${yyyy}-${mm}-${dd}`;
	    }

	    // Set minimum and default values
	  //  document.getElementById('expiryDate').min = getFormattedDate(1);
	   // document.getElementById('startDate').min = getFormattedDate();
	  //  document.getElementById('startDate').value = getFormattedDate(); // Set default value to current date
	</script>
	
	<script>	
		/*function addNewVoucher(event) {
	    event.preventDefault();
	    const tableBody = document.getElementById('voucherTableBody');
	    const rows = tableBody.querySelectorAll('tr');

	    const newRow = document.createElement('tr');
	    newRow.innerHTML = `
	        <td>
	            <div class="autocomp-input-wrap table-input">
	                <input type="text" class="autocomp-input" id="search" oninput="userSearchAndPopulate(this)"
	                       placeholder="Enter Name" autocomplete="off">
	                <div class="autocomplete-dropdown"></div>
	            </div>
	        </td>
	        <td>
	            <input type="text" class="table-input" placeholder="Enter Mobile Number">
	        </td>
	        <td>
	            <input type="text" class="table-input table-input-voucher" onclick="showVoucherModal(this)" placeholder="Select Voucher">
				<input type="hidden" class="table-input table-input-voucher selectMCC"> 
				<input type="hidden" class="table-input table-input-voucher selectPurpose"> 
			    <input type="hidden" class="table-input table-input-voucher selectMCCDescription"> 
				<input type="hidden" class="table-input table-input-voucher selectPurposeDescription">
	        </td>
	        <td>
	            <select class="GeneralSelect redemptionType">
	                <option value="Single">Single</option>
	                <option value="MULTIPLE" selected>Multiple</option>
	            </select>
	        </td>
	        <td>
	            <input type="text" class="table-input" placeholder="Enter Amount">
	        </td>
	        <td>
	            <input type="date" class="table-input table-dateed" placeholder="Select Date" onclick="this.showPicker()">
	        </td>
	        <td>
	            <select class="GeneralSelect validity">
	                <option value="1 days">1 day</option>
	                <option value="7 days">7 days</option>
	                <option value="30 days">30 days</option>
	                <option value="90 days">90 days</option>
					<option value="365 Days">365 Days</option>
	            </select>
	        </td>
	        <td>
	            <a href="#" onclick="deleteRow(this)"><img src="img/delete.svg" alt=""></a>
	        </td>
	    `;

	    // Insert before the error row (3rd last tr)
	    //tableBody.insertBefore(newRow, rows[rows.length - 2]);
		tableBody.appendChild(newRow);
		// Disable past dates
		    const today = new Date().toISOString().split("T")[0];
		    newRow.querySelector('.table-dateed').setAttribute("min", today);
	}*/		function addNewVoucher(event) {
		  event.preventDefault();
		  const tableBody = document.getElementById('voucherTableBody');

		  const newRow = document.createElement('tr');
		  const today = new Date().toISOString().split("T")[0];

		  newRow.innerHTML = `
		    <td>
		        <div class="autocomp-input-wrap table-input">
		            <input type="text" class="autocomp-input" id="search" oninput="userSearchAndPopulate(this)"
		                   placeholder="Enter Name" autocomplete="off">
		            <div class="autocomplete-dropdown"></div>
		        </div>
		    </td>
		    <td>
		        <input type="text" class="table-input" placeholder="Enter Mobile Number">
		    </td>
		    <td>
		        <input type="text" class="table-input table-input-voucher" onclick="showVoucherModal(this)" placeholder="Select Voucher">
		        <input type="hidden" class="table-input table-input-voucher selectMCC"> 
		        <input type="hidden" class="table-input table-input-voucher selectPurpose"> 
		        <input type="hidden" class="table-input table-input-voucher selectMCCDescription"> 
		        <input type="hidden" class="table-input table-input-voucher selectPurposeDescription">
		    </td>
		    <td>
		        <select class="GeneralSelect redemptionType">
		            <option value="Single">Single</option>
		            <option value="MULTIPLE" selected>Multiple</option>
		        </select>
		    </td>
		    <td>
		        <input type="text" class="table-input amonut" placeholder="Enter Amount"
				maxlength="6" oninput="this.value = this.value.replace(/[^0-9]/g, '');validateAmount()" >
		    </td>
		    <td>
		        <input type="date" class="table-input table-dateed" min="${today}" value="${today}" placeholder="Select Date" onclick="this.showPicker()" readonly>
		    </td>
		    <!--<td>
		        <select class="GeneralSelect validity">
		            <option value="1 days">2 day</option>
		            <option value="7 days">7 days</option>
		            <option value="30 days">30 days</option>
		            <option value="90 days">90 days</option>
		            <option value="365 Days">365 Days</option>
		        </select>
		    </td>-->
			<td>
			  <div style="position: relative;">
			    <input type="number"
			           class="table-input validity-input"
			           placeholder="2 - 365"
			           min="2"
			           max="365"
			           oninput="appendDaysSuffix(this)"
			           style="padding-right: 10px; box-sizing: border-box;">
			    <span style="
			      position: absolute;
			      right: 32px;       /* Moves Days left of spinner */
			      top: 50%;
			      transform: translateY(-50%);
			      pointer-events: none;
			      color: #555;
			      font-size: 14px;
			    ">Days</span>
			  </div>
			</td>
		    <td>
		        <a href="#" onclick="deleteRow(this)"><img src="img/delete.svg" alt=""></a>
		    </td>
		  `;

		  tableBody.appendChild(newRow);
		}



	    function userSearchAndPopulate(inputElement) {
	        const query = inputElement.value.toLowerCase();
	        const suggestionsDropdown = inputElement.nextElementSibling;

			const searchInput = document.getElementById('search').value;
			//const searchInput2 = document.getElementById('search');
			//const mobile = document.getElementById('mobile');
		    const employerId = document.getElementById('employerId').value;

						$.ajax({
			            type: "POST",
			            url: "/voucherUserSearch",
			            dataType: 'json',
			            data: {
			                "orgId": employerId,
			                "userName": query
			            },
			            success: function (data) {
			                //document.getElementById("signinLoader").style.display = "none";
					          // const query = searchInput2.value.toLowerCase();
					           if (query) {
					              // const filteredUsers =  data.data.filter(user => user.username.toLowerCase().includes(query) || user.username.toLowerCase().includes(query));
					              // displaySuggestions(filteredUsers);
								  const filteredUsers = data.data.filter(user => user.username.toLowerCase().includes(query) || user.username.toLowerCase().includes(query));
								  displaySuggestions(filteredUsers, inputElement, suggestionsDropdown);
					           } else {
					               suggestionsDropdown.style.display = 'none';
					           }
					     
			               
			            },
			            error: function (e) {
			                document.getElementById("signinLoader").style.display = "none";
			                console.error('Error:', e);
			                alert('An error occurred while fetching the data.');
			            }

	      });
	      
	    }

		 function displaySuggestions(userList, inputElement, dropdown) {
			        dropdown.innerHTML = '';
			        userList.forEach(user => {
			            const div = document.createElement('div');
			            div.classList.add('autocomplete-suggestion');
			            const base64Image = user.empPhoto 
			                ? `<img class="user-photo" src="data:image/jpeg;base64,${user.empPhoto}" alt="Emp Photo" width="30" height="30" style="border-radius: 50%; vertical-align: middle;">`
			                : `<img class="img-profile rounded-circle" src="img/no-image-available.png" width="30" height="30" style="border-radius: 50%; vertical-align: middle;">`;
							div.innerHTML = `
							            <div style="display: flex; align-items: center; width: 100%; gap: 8px;">
							                ${base64Image}
							                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
							                    <span style="text-align: left; flex: 1;">${user.username}</span>
							                    <span style="text-align: right; flex: 1;">${user.empCode}</span>
							                    <span style="text-align: right; flex: 1;">${user.mobile}</span>
							                </div>
							            </div>
							        `;

			            div.addEventListener('click', function () {
			                inputElement.value = user.username;
			                // Assuming you want to populate the mobile field next to the inputElement
			                inputElement.closest('tr').querySelector('input[placeholder="Enter Mobile Number"]').value = user.mobile;
			                dropdown.style.display = 'none';
			            });

			            dropdown.appendChild(div);
			        });
			        dropdown.style.display = userList.length > 0 ? 'block' : 'none';
			    }

		function showVoucherModal(inputElement) {
		        const modal = document.getElementById('modalforvccategoryforbulkissuance');
		        modal.style.display = 'block';
		    }

		    function closeModal() {
		        const modal = document.getElementById('modalforvccategoryforbulkissuance');
		        modal.style.display = 'none';
		    }

		    // Ensure modals are closed properly
		    window.onclick = function(event) {
		        const modal = document.getElementById('modalforvccategoryforbulkissuance');
		        if (event.target == modal) {
		            modal.style.display = 'none';
		        }
		    };
	    function deleteRow(button) {
	        const tableBody = document.getElementById("voucherTableBody");
	        const rows = tableBody.querySelectorAll("tr");

	        if (rows.length <= 1) {
	            alert("Cannot delete the first row.");
	            return;
	        }

	        const row = button.parentElement.parentElement;
	        tableBody.removeChild(row);
	    }
	</script>	
	
	<script>
	    let currentRowInput;

	    function showVoucherModal(inputElement) {
	        currentRowInput = inputElement;
	        const modal = document.getElementById('modalforvccategoryforbulkissuance');
	        modal.style.display = 'block';
	    }

	    function getVoucherDetail() {
	        // Get the selected voucher data (image and name)
	        const selectedVoucherItem = document.querySelector('.voucher-item.selected');
	        
	        let selectedVoucherName = null;
	        let selectedVoucherCode = null;
	        let selectedPurposeCode = null;
	        let selectedPurposeName = null;

	        if (selectedVoucherItem) {
	            selectedVoucherCode = selectedVoucherItem.querySelector('input[name="voucherCode"]').value;
	            selectedVoucherName = selectedVoucherItem.querySelector('span').textContent;
	        } else {
	            alert('No voucher selected!');
	            return false;
	        }

	        // Get the selected radio button data (Purpose List)
	        const selectedRadioButton = document.querySelector('input[name="selectvouchers"]:checked');
	        if (selectedRadioButton) {
	            selectedPurposeCode = selectedRadioButton.closest('li').getAttribute('data-value');
	            selectedPurposeName = selectedRadioButton.closest('li').querySelector('span').textContent;
	            const show = selectedPurposeName.substring(0, 5);
	        } else {
	            alert('No purpose selected!');
	            return false;
	        }

	        // Assuming currentRowInput is set correctly to the clicked input element
	        if (currentRowInput) {
	            const currentRow = currentRowInput.closest('tr');
	            //currentRow.querySelector('.table-input-voucher').value = selectedVoucherName.substring(0, 5) + " | " + selectedPurposeName.substring(0, 5) + "...";
				currentRow.querySelector('.table-input-voucher').value = selectedPurposeName;
							
				let parts = selectedPurposeCode.split("|");
				console.log(parts[0]); // "5411"
				console.log(parts[1]); // "3A"
				currentRow.querySelector('.selectMCC').value =  parts[0];// "5411"
	            currentRow.querySelector('.selectPurpose').value  = parts[1]; // "3A"
	            currentRow.querySelector('.selectMCCDescription').value  = selectedVoucherName;
	            currentRow.querySelector('.selectPurposeDescription').value = selectedPurposeName;
	        }
	        // Hide the modal
	        closeModal();
	    }

	    function closeModal() {
	        const modal = document.getElementById('modalforvccategoryforbulkissuance');
	        modal.style.display = 'none';
	    }
	</script>
    <!-- Modal Issue Vouchers -->
    <div class="customModal" id="modalforvccategoryforbulkissuance">
        <div class="modal-dialog modal-dialog-centered modal-approval-wrap modal-xxl" role="document">
            <div class="modal-content modal-bulk my-2">                 
                <div class="modal-body text-left p-0">
                    <div class="tab-content m-0">
                        <div class="upi-voucher-wrap m-0 p-0">
                            <div>
                                <h3>Select Voucher Category for Voucher Issuance </h3>
                                <p>Select Vouchers from the selection provided below, and continue to enter details for issuance. </p>
                            </div>

                            <hr>

                            <div class="row">
                                <div class="col-12 col-md-4">
                                    <div class="leftselctVoucehrs" >
                                        <h4>Vouchers Categories</h4>
                                        <ul id="voucherList">
                                           
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-12 col-md-8 pl-sm-0">
                                    <div class="rightselctVoucehrs" id="mccDiv" style="display: none;">
                                        <div class="row">
                                            <div class="col-12 col-md-3">
                                                <div class="select-upivouchers">
                                                    <img id="voucherImageId" src="img/fuelVouchers.svg" alt="" class="img-fluid" height="150px" width="200px">
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-7">
                                                <div class="cards-upivouchers-desc">
                                                    <h4><span id="voucherTextId"></span> Vouchers</h4>
                                                    <p>To issue e-RUPI Voucher, please select a category, a sub-category or an associated brand: </p>
                                                </div>
                                            </div>
                                        </div>

                                        <hr>

                                        <div class="row">
                                            <div class="col-12">
                                                <div class="selctedVoucehr">
                                                    <ul id="purposeList">
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12 text-right mt-3">
                                   <!-- <button class="btn btn-border-primary mb-1" onclick="window.location.href='create-upi-voucher-issue-manually.html';">Back</button>-->
								   <button class="btn btn-border-primary mb-1" onclick="closeModal()">Back</button>
                       			   <button class="btn btn-primary mb-1" onclick="getVoucherDetail()">Continue</button>
								 </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

	<div id="otpModal1" class="customModal modal">
	    <div class="modal-dialog modal-dialog-centered modal-approval-wrap" role="document">
	        <div class="modal-content modal-bulk">
	            <div class="modal-header pb-0 text-center">
	                <h5 class="modal-title w-100" id="exampleModalCenterTitle">Authentication for Issuance</h5>
					<button type="button"
					           style="border: none; background: none; font-size: 1.5rem; position: absolute; top: 10px; right: 0px; line-height: 1; padding: 0 20px;"
					           aria-label="Close"
					           onclick="closeOtpModal()">
					       &times;
					   </button>
	            </div>
	            <div class="modal-body text-center">
	                <div class="otp-box-onboarding justify-content-center">
					
						<input  class="form-control form-control-sm test" type="password" id="password1" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password1" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password2" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password2" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password3" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password3" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password4" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password4" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password5" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password5" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password6" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password6" maxlength="1" autocomplete="off" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="hidden" id="orderId" 
					        name="orderId" >
							<div class="d-flex justify-content-center mt-2">
							    <i class="fa-solid fa-eye" id="toggleOtpIcon" style="cursor: pointer; margin-top: 6px;" onclick="toggleOtpVisibility()"></i>
							</div>
	                </div>
	               <label class="time-otp ml-0 text-dark" for="" id="countdown" style="color: green;"></label>
				  <!-- <div class="text-center" id="countdown" style="color: green;"></div>-->
					<p id="resendCode">Didn’t receive the code?  <a href="#" onclick="resendVoucherOTP()">Resend OTP</a></p>
					
					<div class="error-msg" id="otpError" style="color:red"></div>
					
	                <div class="tip-wrap justify-content-center">
	                    <p class="mb-0" id="maskedMobileDisplay"></p>
	                </div>
					
					
					
	                <div class="d-flex justify-content-center mt-3">
						<!--
	                    <button class="btn btn-primary w-100" id="authenticatereport">Authenticate</button>
						-->
						<button class="btn btn-primary w-100" id="authenticate" onclick="verfyIssueVoucherOTP()">AUTHENTICATE</button>
	                </div>
	            </div>
	      

    <!-- Modal Choose Type of Advance Request -->
    <div class="modal fade" id="Modal-upivouchers-info" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-approval-wrap modal-lg" role="document">
            <div class="modal-content modal-bulk">
                <div class="modal-header pb-0">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Voucher Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="d-block">
                        <p>These are e-RUPI Vouchers that are person and purpose specific. They can be redeemed using
                            UPI Apps. To learn more, <a href="#"><b>click here.</b></a></p>
                    </div>
                    <div class="specificDetails">
                        <h4>Voucher Specific Details</h4>
                        <p>Category: <strong>Meal</strong></p>
                        <p class="mb-0">Eligible Merchants: <strong>Restaurants, Food Ordering Platforms, Fast
                                Food</strong></p>
                    </div>

                    <div class="specificDetails-white">
                        <h4>Brands Available</h4>
                        <hr>
                        <div class="d-flex">
                            <img src="img/zomato.svg" alt="">
                            <img src="img/swiggy.svg" alt="">
                            <img src="img/dominos.svg" alt="">
                            <img src="img/freshmenu.svg" alt="">
                        </div>
                    </div>

                    <div class="d-flex justify-content-center mt-3">
                        <button class="btn btn-primary w-100">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<script>
	function closeOtpModal() {
	    document.getElementById("otpModal1").style.display = "none";
		window.location.href = "/upiVoucherIssuanceManually";
	}
	</script>

	<script>
	function toggleOtpVisibility() {
	    const icon = document.getElementById("toggleOtpIcon");
	    const inputs = document.querySelectorAll('.otp-box-onboarding input');

	    const isHidden = inputs[0].type === 'password';
	    inputs.forEach(input => {
	        if (input.id.startsWith('password')) {
	            input.type = isHidden ? 'text' : 'password';
	        }
	    });

	    icon.classList.toggle('fa-eye');
	    icon.classList.toggle('fa-eye-slash');
	}
	</script>

	
	
</body>

</html>