<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Create UPI Voucher Issuance - Issue Manually</title>

    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="css/slick/slick-theme.css" />
	<script type="text/javascript" src="js/xsls-export.js"></script>
   
	<!-- Font Awesome 6 Free (Latest) -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

</head>


<body id="page-top" onload="getLinkedBankDetail(),getTotalVoucherCount(),getRequestedEmployeeList()" >

 <div class="bs-canvas-overlay bg-dark position-fixed w-100 h-100"></div>

    <!-- Page Wrapper -->
    <div id="wrapper">

	<!-- Sidebar -->
					      
	 <div th:insert="fragments/sidenav.html :: sidevav"></div> 
	
	 <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar static-top">

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav top-nav">

                        <!-- Nav Item - User Information -->
                        <li class="nav-item">
                            <a class="nav-link active" href="#">
                                <span class="mr-2 small">Dashboard</span>
                                <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span class="mr-2 small">UPI Voucher  Issuance</span>
                                <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                            </a>
                        </li>
                    </ul>
					<!-- Right Icons + Profile -->
								    <ul class="navbar-nav d-flex flex-row align-items-center mb-0">
								      <!-- Wallet Icon -->
								     <!-- <li class="nav-item mr-3">
								        <a href="/settings/wallet" role="button">
								          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
								        </a>
								      </li>-->
									  <li class="nav-item mr-3">
					  			        <a href="/cotowallet" role="button">
					  			          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
					  			        </a>
					  			      </li>
								      <!-- Notification Icon -->
								      <li class="nav-item mr-3">
								        <a href="#" role="button">
								          <img src="img/Notification-icon.png" alt="Notification" class="nav-icon-img">
								        </a>
								      </li>

								      <!-- Profile Dropdown -->
								      <li class="nav-item dropdown no-arrow">
								        <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								          <img class="img-profile rounded-circle" src="img/undraw_profile.svg" alt="User" style="width: 32px; height: 32px;">
								        </a>
								        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
								          <a class="dropdown-item" href="/ProfileInfo">
								            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Profile
								          </a>
								       <!--   <a class="dropdown-item" href="#">
								            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> Settings
								          </a>-->
								          <div class="dropdown-divider"></div>
								          <a class="dropdown-item" href="/logout">
								            <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout
								          </a>
								        </div>
								      </li>
								    </ul>
                </nav>

                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid p-0 p-md-1">
                    <div class="row">
                        <div class="col-12">
                            <div class="tab-content">
                                <div class="upi-voucher-wrap">
                                    <div class="d-flex justify-content-center align-items-center">
                                        <h3 class="mb-0">UPI Voucher Issuance </h3>
                                    </div>
                                    <div class="col-12 col-md-8 mx-auto">
                                        <div class="breadcrumb-wrap">
                                            <div class="breadcrumb-in active">
                                                <span>1</span>
                                                <label>Enter Voucher Details</label>
                                            </div>
                                            <div class="breadcrumb-in"  id="lable2">
                                                <span>2</span>
                                                <label>Authenticate Issuance</label>
                                            </div>
                                            <div class="breadcrumb-in" id="lable3">
                                                <span>3</span>
                                                <label>Vouchers Issued</label>
                                            </div>
                                        </div>
                                    </div>
										
                                </div>
                            </div>

                            <div class="selectvouchers-update">
                                <p>Last updated on</p>
                                <span th:text="${session.formattedDate}" ></span>
                            </div>

                            <div class="selectvouchers-top">
                                <div class="selectvouchers-topleft">
                                    <div class="selectvouchers-topleft-cards">
                                     
										<select class="GeneralSelect" id="banklist" onchange="getBankDetailByBankAccountNumber();showLinkedAccAmount(this.value)">
										     <option value="" class="test">Select Bank</option>
	                                     </select>
                                        <div class="div-2">
                                            <div class="text-wrapper-2">Available Balance</div>
                                            <p class="element"><span class="span">â‚¹</span> <span
                                                    class="text-wrapper-3">0,00,000</span></p>
                                            <img class="recall" id="recallBalance" src="img/recall.svg">
                                        </div>
                                        <p class="last-updated-on"><span th:text="${session.formattedDate}" ></span></p>

                                    </div>
									<div class="selectvouchers-topleft-cards selectvouchers-topleft-primary">
                                       <h5>Total Vouchers</h5>
                                       <div class="d-flex justify-content-between my-1 mb-3">
                                           <span>Number</span>
                                           <span id="totalNumber"></span>
                                       </div>
                                       <div class="d-flex justify-content-between my-1">
                                           <span>Value</span>
                                           <span id="totalValue"></span>
                                       </div>
                                   </div>
                                </div>
							<!--	
							  <div class="selectvouchers-topright">
		                              <div class="selectvouchers-carosel responsive-content-demo" >
		                                 <div id="jsonData" class="demo-slider"></div>
		                                  
		                              </div>
		                          </div>
								  -->
                            </div>
							<div class="upi-voucher-wrap selectvouchers-bottom" id="selectemployee-wrap03">
	                              <div class="d-flex">
	                                  <h3>Employee List </h3>
	                              </div>

	                              <div>
	                                  <p>Please input the details for the issuance of vouchers.</p>
	                              </div>

	                              <div class="table-responsive">
	                                  <table class="table table-reimbursements selectvouchers-table" id="employeelist">
	                                      <thead>
	                                          <tr>
	                                              <th>Employee Name</th>
												  <th>Mobile Number</th>
	                                              <!-- <th>DOB</th>-->
	                                              <th>VOUCHER CATEGORY</th>
	                                              <th>PURPOSE CODE</th>
	                                              <!--   <th>eMPLOYMENT TYPE</th>-->
	                                              <th>AMOUNT</th>
	                                              <!--  <th>DOJ</th>-->
	                                            <!--  <th>EMAIL</th>-->
												  <th>EMPLOYEE REMARK</th>
												  <th>VALIDITY IN DAYS</th>
												  <th>STATUS</th>
												  <th>ACTION</th>
	                                          </tr>
	                                      </thead>
	                                      <tbody>
											
	                                      </tbody>
	                                  </table>
	                              </div>

	                          							
	                          </div>

                            <div class="upi-voucher-wrap selectvouchers-bottom" id="selectvouchers-wrap03" style="display: none;">
                                <div class="d-flex">
                                    <h3>Enter Details </h3>
                                </div>

                                <div>
                                    <p>Please input the details for the issuance of vouchers.</p>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-reimbursements selectvouchers-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Mobile Number</th>
                                                <th>Voucher Type</th>
                                                <th>Redemption Type</th>
                                              	<th>Requested Amount</th>
												<th>Amount</th>
                                                <th>Start Date</th>
                                                <th>Validity</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="voucherTableBody">
                                            <tr>
                                                <td>
                                                    <div class="autocomp-input-wrap table-input">
                                                        <input type="text" class="autocomp-input " id="search"
                                                            placeholder="Enter Name" autocomplete="off">
                                                        <div id="autocomplete-suggestions"
                                                            class="autocomplete-dropdown"></div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <input type="text" class="table-input" id="mobile" maxlength="10" 
													 oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                                                     placeholder="Enter Mobile Number">
                                                </td>
                                                <td>
                                                    <input type="text" class="table-input" id="btnforvccategoryforbulkissuance"
                                                     placeholder="Select Voucher">
                                                </td>
                                                <td>
                                                    <select class="GeneralSelect" id="redemptionType">
                                                        <option value="" class="test">Choose Type </option>
                                                        <option value="Single">Single</option>
                                                        <option value="Multi" selected>Multi</option>
                                                    </select>
                                                </td>
												<td>
                                                    <input type="text" class="table-input" id="requestedamount" placeholder="Requested Amount"
													oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');validateAmount()" maxlength="6" readonly>
                                                </td>
                                                <td>
                                                    <input type="text" class="table-input" id="amount" placeholder="Enter Amount"
													oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');validateAmount1()" maxlength="6">
                                                </td>
                                                <td>
                                                    <div>
                                                        <input type="date" class="table-input" id="startDate" placeholder="Salect Date">
                                                    </div>
                                                </td>
                                                <td>
                                                    <select class="GeneralSelect" id="expiryDate">
                                                        <option value="7 Days" class="test">7 Days </option>
														<option value="15 Days">15 Days</option>
                                                        <option value="30 Days">30 Days</option>
                                                        <option value="90 Days">90 Days</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <a href="#" onclick="deleteRow(this)"><img src="img/delete.svg" alt=""></a>
                                                </td>
                                            </tr>
											<tr>
                                           <td>
											  <div class="error-msg" id="beneficiaryNameError" style="color:red"></div>
										   </td>
										   <td>
											<div class="error-msg" id="beneficiaryMobileError" style="color:red"></div>

                                            </td>
                                           <td>
											<div class="error-msg" id="voucherError" style="color:red"></div>

                                           </td>
                                           <td>
											<div class="error-msg" id="redemptionTypeError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="amountError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="startDateError" style="color:red"></div>
                                           </td>
                                           <td>
											<div class="error-msg" id="expiryDateError" style="color:red"></div>
                                           </td>
                                           <td>
											
                                           </td>
                                       </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div class="w-100 my-3 text-right">
                                    <button class="btn btn-border-primary"
                                        onclick="backEmployeeList()">Back</button>
                                    <button type="button"id="continueButton1" class="btn btn-primary" onclick="singleVoucherValidation()">Continue</button>
                                </div>								
                            </div>

							<div class="upi-voucher-wrap selectvouchers-bottom" id="selectvouchers-wrap04" style="display: none;">
	                                <div class="d-flex">
	                                    <h3>Verify Details </h3>
	                                </div>
	                                <div>
	                                    <p>Please Verify the details for the issuance of vouchers.</p>
	                                </div>

	                                <div class="table-responsive">
	                                    <table class="table table-reimbursements selectvouchers-table">
	                                        <thead>
	                                            <tr>
	                                                <th>Name</th>
	                                                <th>Mobile</th>
	                                                <th>Voucher Type</th>
	                                                <th>Redemption Type</th>
	                                                <th>Amount</th>
	                                                <th>Start Date</th>
	                                                <th>Validity</th>
	                                            </tr>
	                                        </thead>
												<tbody>
	                                                <tr>
	                                                    <td><span id="namelbl"></span></td>
														<td><span id="mobilelbl"></span></td>
	                                                    <td><span id="voucherlbl"></span></td>
	                                                    <td><span id="redemptionLbl"></span></td>
														<!--<td><span id="vmcclbl"></span></td>-->
	                                                    <td><span id="amountlbl"></span></td>
	                                                    <td><span id="startdatelbl"></span></td>
	                                                    <td><span id="validitylbl"></span></td>
	                                                           
	                                                </tr>
	                                               
	                                            </tbody>
	                                    </table>
	                                </div>
									<div class="form-group mt-3">
                                       <div class="custom-control custom-checkbox small">
                                           <input type="checkbox" class="custom-control-input" id="customCheck45" onchange="toggleSubmitButton()">
                                           <label class="custom-control-label text-left" for="customCheck45">I confirm
                                               that the details uploaded above are correct to the best of my knowledge,
                                               and are approved by the competent authority in my organization.</label>
                                       </div>
									<div class="error-msg" id="errorMessage" style="color:red"></div>
                                   </div>

								   <div class="clearfix"></div>
								   <div id="issuemsgdiv" style="display:none" class="alert alert-success text-center">
								   	<div id="issuesuccmsg"></div>   
								   </div>
								   <div id="issuesfailmsgDiv" style="display:none" class="alert alert-danger text-center">
								   	<div id="issuesfailmsg"></div>
								   </div>	
								   
	                                <div class="w-100 my-3 text-right">
	                                    <button class="btn btn-border-primary" id="verifyDetailBack">Back</button>
	                                    <button class="btn btn-primary" id="submitButton"  disabled >Issue Voucher</button>
	                                </div> 
									<input type="hidden" class="form-input" id="employerMobile" name="employerMobile" th:value="${session.mobile}"> 
									<input type="hidden" class="form-input" id="employerId" name="employerId" th:value="${session.id}"> 
									<input type="hidden" class="form-input" id="employerName" name="employerName" th:value="${session.username}"> 
									<input type="hidden" class="form-input" id="voucherId" name="voucherId"> 
									<input type="hidden" class="form-input" id="voucherCode" name="voucherCode"> 
									<input type="hidden" class="form-input" id="voucherType" name="voucherType"> 
									<input type="hidden" class="form-input" id="voucherSubType" name="voucherSubType"> 
									<input type="hidden" class="form-input" id="voucherDesc" name="voucherDesc"> 
									<input type="hidden" class="form-input" id="purposeCode" name="purposeCode"> 
									<input type="hidden" class="form-input" id="purposeName" name="purposeName"> 
									<input type="hidden" class="form-input" id="activeStatus" name="activeStatus"> 
									<input type="hidden" class="form-input" id="createdby" name="createdby"> 
									<input type="hidden" class="form-input" id="bankName" name="bankName"> 
									<input type="hidden" class="form-input" id="bankCode" name="bankCode"> 
									<input type="hidden" class="form-input" id="accountHolderName" name="accountHolderName"> 
									<input type="hidden" class="form-input" id="acNumber" name="acNumber">
									<input type="hidden" class="form-input" id="accountType" name="accountType"> 
									<input type="hidden" class="form-input" id="ifsc" name="ifsc">
									
									<input type="hidden" class="form-input" id="erupiFlag" name="erupiFlag"> 
									<input type="hidden" class="form-input" id="branchCode" name="branchCode"> 
									<input type="hidden" class="form-input" id="authStatus" name="authStatus">
									
									<input type="hidden" class="form-input" id="authResponse" name="authResponse">
									<input type="hidden" class="form-input" id="banklinkedMobile" name="mobile"> 
									<input type="hidden" class="form-input" id="accstatus" name="accstatus"> 
									
									<input type="hidden" class="form-input" id="orgId" name="orgId"> 
									<input type="hidden" class="form-input" id="orgCode" name="orgCode"> 
									<input type="hidden" class="form-input" id="tid" name="tid"> 
									<input type="hidden" class="form-input" id="merchentIid" name="merchentIid"> 
									<input type="hidden" class="form-input" id="mcc" name="mcc"> 
									<input type="hidden" class="form-input" id="submurchentid" name="submurchentid"> 
									<input type="hidden" class="form-input" id="merchentid" name="merchentid">
									<input type="hidden" class="form-input" id="payerva" name="payerva"> 	
									
									<input type="hidden" class="form-input" id="requestId" name="requestId">												
	                        </div>
							
							<div class="upi-voucher-wrap" id="upi-voucher-wrapThree" style="display: none;">
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        <h3>Report for Voucher Issuance</h3>
                                        <p>Please cross-check the details for the issuance of vouchers. </p>
                                    </div>
                                    <div class="rightdownload mb-3">
                                        <button class="download-vc" id="downloadBtn">
                                            <img src="img/download-vouchers.svg" alt="">
                                        </button>
                                    </div>
                                </div>
                                <hr>

								<div class="table-responsive">
						        <table class="table table-reimbursements selectvouchers-table" id="successFailVoucherTable">
						            <thead>
						                <tr>
						                    <th>Name</th>
						                    <th>Mobile Number</th>
						                    <th>Voucher Type</th>
						                    <th>Redemption Type</th>
						                    <th>Amount</th>
						                    <th>Start Date</th>
						                    <th>Validity</th>
						                    <th>Status</th>
						                    <th></th>
						                </tr>
						            </thead>
						            <tbody>
						                
						            </tbody>
						        </table>
						    </div>
                      
                                <div class="row">
                                    <div class="col-12 text-right my-3">
                                        <a th:href="@{/upiVoucherIssuanceNew}" class="btn btn-primary mb-1">GO TO DASHBOARD</a>
                                    </div>
                                </div>


                            </div>
							
                        </div>
                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->
        </div>
		

		<div class="lds-spinner" id="signinLoader" style="display: none">
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
			<div></div>
		</div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

	<!-- Bootstrap core JavaScript-->
	  <script src="vendor/jquery/jquery.min.js"></script>
	  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

	  <!-- Core plugin JavaScript-->
	  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

	  <!-- Custom scripts for all pages-->
	  <script src="js/sb-admin-2.min.js"></script>

	  <!-- Page level plugins -->
	  <script src="vendor/datatables/jquery.dataTables.min.js"></script>
	  <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

	  <!-- Page level custom scripts -->
	  <script src="js/demo/datatables-demo.js"></script>

	  <!-- <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script> -->
	  <script type="text/javascript" src="js/slick/slick.min.js"></script>
	  <link rel="stylesheet" href="css/custom.css">
	
	<script type="text/javascript" src="cotodel-js/sanitize-input.js"></script>
	<script type="text/javascript" src="cotodel-js/requested-voucher-creation.js"></script>
	<script type="text/javascript" src="cotodel-js/requested-upi-voucher-issue.js"></script>
	<script>
			function toggleOtpVisibility2() {
			    const icon = document.getElementById("toggleOtpIcon2");
			    const inputs = document.querySelectorAll('.otp-box-onboarding input');

			    const isHidden = inputs[0].type === 'password';
			    inputs.forEach(input => {
			        if (input.id.startsWith('password')) {
			            input.type = isHidden ? 'text' : 'password';
			        }
			    });

			    icon.classList.toggle('fa-eye');
			    icon.classList.toggle('fa-eye-slash');
			}
			</script>

			
		<style>	@keyframes rotate360 {
		    from {
		        transform: rotate(360deg);
		    }
		    to {
		        transform: rotate(0deg);
		    }
		}

		.rotate {
		    animation: rotate360 0.6s linear; /* 0.6s for a smooth rotation */
		} </style>
		<script>				document.getElementById("recallBalance").addEventListener("click", function() {
		    var recallIcon = this;
		    var selectedBankAccount = document.getElementById("banklist").value; 

		    // Add rotation class
		    recallIcon.classList.add("rotate");

		    // Remove rotation class after animation completes
		    setTimeout(() => {
		        recallIcon.classList.remove("rotate");
		    }, 600);

		    // Validate selection
		    if (selectedBankAccount) {
		        showLinkedAccAmount(selectedBankAccount);
		    } else {
		        alert("Please select a bank account first.");
		    }
		});

		function showLinkedAccAmount(accountNumber) {
		    var employerid = document.getElementById("employerId").value;
		    console.log("Fetching balance for account:", accountNumber, "Employer ID:", employerid);

		    $.ajax({
		        type: "POST",
		        url: "/showLinkedAccAmount",
		        data: {
		            "acNumber": accountNumber,
		            "orgId": employerid
		        },
		        success: function(response) {
		            console.log("API Response:", response);

		            let obj = typeof response === "string" ? JSON.parse(response) : response;

		            if (obj.status) {
		                // Update balance
		                document.querySelector(".text-wrapper-3").textContent = obj.balance || "Amount Not Available";

		                // Update timestamp
		                if (obj.timestamp) {
		                    document.querySelector(".last-updated-on span").textContent = formatTimestamp(obj.timestamp);
		                }
		            } else {
		                alert("Failed to fetch balance.");
		            }
		        },
		        error: function(error) {
		            console.error("Error fetching balance:", error);
		            alert('Error fetching balance.');
		        }
		    });
		}

		function formatTimestamp(timestamp) {
		    let dateObj = new Date(timestamp.replace(" ", "T"));

		    let hours = dateObj.getHours().toString().padStart(2, '0');
		    let minutes = dateObj.getMinutes().toString().padStart(2, '0');
		    let seconds = dateObj.getSeconds().toString().padStart(2, '0');

		    let day = dateObj.getDate();
		    let month = dateObj.toLocaleString('en-US', { month: 'short' });
		    let year = dateObj.getFullYear();
		    let weekday = dateObj.toLocaleString('en-US', { weekday: 'short' });

		    return `${hours}:${minutes}:${seconds} ${weekday} ${day} ${month} ${year}`;
		}


	</script>
	
	<script>
		
		function getRequestedEmployeeList(){ 
		    document.getElementById("signinLoader").style.display="flex";
		    const employerId = document.getElementById('employerId').value;
		    $.ajax({
		        type: "GET",
		        url: "/getRequestedVoucherApproveList",
		        data: { employerId },
		        success: function(data) {
		            newData = data;
		            var data1 = jQuery.parseJSON(newData);
		            var data2 = data1.data;
		            console.log("getRequestedEmployeeList()", data2);
		            document.getElementById("signinLoader").style.display="none";

		            var table = $('#employeelist').DataTable({
		                destroy: true,
		                lengthChange: true,
		                responsive: true,
		                searching: true,
		                bInfo: false,
		                paging: true,
		                autoWidth: false,
		                pagingType: "full_numbers",
		                pageLength: 50,
		                buttons: ["csv", "excel"],
		                language: { "emptyTable": "Records Not Available." },
		                aaData: data2,
		                aoColumns: [
		                    { "mData": "name" },
		                    { "mData": "mobile" },
		                    { "mData": "voucherType" },
		                    { "mData": "voucherSubType" },
		                    { "mData": "amount" },
		                    { "mData": "remarks" },
							{ "mData": "validity" },
							{
							"mData": "statusMessage",
							"render": function (status, type, row) {
								let style = "";
								if (status === "Requested") {
									style = "color:#ffc107; font-weight:bold;";
								} else if (status === "Voucher Created") {
									style = "color:#28a745; font-weight:bold;";
								} else if (status === "Approved by manager") {
									style = "color:#007bff; font-weight:bold;";
								}
								else if(status==="Rejected by manager"){
									style ="color:#dc3545; font-weight:bold;";
									}
								return `<span style="${style}">${status || "N/A"}</span>`;
							}
						}, 
		                    { "mData": "id", "render": function (data2, type, row) {
		                        if (row.statusMessage !== "Voucher Created") {
		                            return `
		                                <td>
		                                    <div class="dropdown no-arrow ml-2">
		                                        <a class="dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		                                            <i class="fas fa-ellipsis-v fa-sm"></i>
		                                        </a>
		                                        <br>
		                                        <div class="dropdown-menu dropdown-menu-right shadow" aria-labelledby="userDropdown">
		                                            <button 
		                                                class="dropdown-item py-2" 
		                                                value="${data2}" 
		                                                id="btnIssue" 
		                                                onclick="getRowData(this)">
		                                                Issue Voucher
		                                            </button>
		                                        </div>
		                                    </div>
		                                </td>`;
		                        } else {
		                            return '';
		                        }
		                    }}
		                ],
		            });
		        },
		        error: function(e) {
		            alert('Failed to fetch JSON data' + e);
		        }
		    });
		}

	/* old working function 
	function getRowData(btnIssue) {
		var selectedBank = document.getElementById("banklist").value;
		    
		    if (!selectedBank) {
		        alert("Please select a bank account before selecting a row.");
				return;
		    }
			
	    var table = $('#employeelist').DataTable();
	    var row = $(btnIssue).closest('tr');
	    var rowData = table.row(row).data();
	    
	    console.log("Id of selected record", rowData.id);
	    
	    document.getElementById("requestId").value = rowData.id;
	    document.getElementById("search").value = rowData.name;
	    document.getElementById("mobile").value = rowData.mobile;
	    document.getElementById("btnforvccategoryforbulkissuance").value = rowData.voucherType + "|" + rowData.voucherSubType;
	    
	    // Get the available balance from .text-wrapper-3
	    let availableBalanceText = document.querySelector(".text-wrapper-3").innerText.replace(/[^0-9.]/g, "");
	    let availableBalance = parseFloat(availableBalanceText.replace(/,/g, '')) || 0; // Convert to number

	    // Get row amount and compare
	    let requestedAmount = parseFloat(rowData.amount) || 0;
	    let finalAmount = (requestedAmount > availableBalance) ? availableBalance : requestedAmount;
	    
	    document.getElementById("amount").value = finalAmount.toFixed(2);
		document.getElementById("requestedamount").value = finalAmount.toFixed(2);

	    document.getElementById("voucherCode").value = rowData.purposeCode;
	    document.getElementById("purposeCode").value = rowData.mcc;
	    document.getElementById("voucherType").value = rowData.voucherType;
	    document.getElementById("voucherSubType").value = rowData.voucherSubType;
	    document.getElementById("mcc").value = rowData.mcc;
	    
	    $("#selectvouchers-wrap03").show();
	    $("#selectemployee-wrap03").hide();
	}*/
	function getRowData(btnIssue) {
	    var selectedBank = document.getElementById("banklist").value;
	    
	    if (!selectedBank) {
	        alert("Please select a bank account before selecting a row.");
	        return;
	    }
	    
	    var table = $('#employeelist').DataTable();
	    var row = $(btnIssue).closest('tr');
	    var rowData = table.row(row).data();

	    console.log("Id of selected record", rowData.id);

	    document.getElementById("requestId").value = rowData.id;
	    document.getElementById("search").value = rowData.name;
	    document.getElementById("mobile").value = rowData.mobile;
	    document.getElementById("btnforvccategoryforbulkissuance").value = rowData.voucherType + "|" + rowData.voucherSubType;

	    // Always use row amount regardless of bank balance
	    let rowAmount = parseFloat(rowData.amount) || 0;

	    document.getElementById("amount").value = rowAmount.toFixed(2);
	    document.getElementById("requestedamount").value = rowAmount.toFixed(2);

	    document.getElementById("voucherCode").value = rowData.purposeCode;
	    document.getElementById("purposeCode").value = rowData.mcc;
	    document.getElementById("voucherType").value = rowData.voucherType;
	    document.getElementById("voucherSubType").value = rowData.voucherSubType;
	    document.getElementById("mcc").value = rowData.mcc;

	    $("#selectvouchers-wrap03").show();
	    $("#selectemployee-wrap03").hide();
	}


	function backEmployeeList(){

		$("#selectvouchers-wrap03").hide();
		$("#selectemployee-wrap03").show();
	}
	</script>
	<script>
			$('.responsive-content').slick({
            dots: false,
            infinite: false,
            speed: 300,
            slidesToShow: 4,
            slidesToScroll: 1,
            draggable: false,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 1,
                        infinite: true
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1,
                        slidesToScroll: 1
                    }
                }
            ]
        });
	</script>
	<script type="text/javascript">

	$(document).ready(function(){	
		  $('li.active').removeClass('active').removeAttr('aria-current'); 
		  $('a[href="' +'/upiVoucherIssuanceNew"]').closest('li').addClass('active').attr('aria-current', 'page');   
		  
	   $(".innernav").click(function(){
	       $(".dropdownNav").addClass("active");
	   });
	});

	</script>
	<script>
	  $(document).ready(function() {
	    $('#submitButton').click(function() {
	      // Call the AJAX function
		  document.getElementById('submitButton').disabled=true;
		  const checkbox = document.getElementById('customCheck45');
	  		 const errorMessage = document.getElementById('errorMessage');
	  		 if (checkbox.checked) {
	  		    errorMessage.textContent = "";
	  		  } else {
	  		    errorMessage.textContent = "Please check consent"; 
	  			return false;
	  		  }
	  		
		  var employerMobile = document.getElementById("employerMobile").value;
		  document.getElementById("authenticate").disabled = false;
	      $.ajax({
	        url:"/smsOtpSender",
	        type: 'POST',
			data: {
						"mobile": employerMobile,
					},
			dataType: 'json',
			success: function(data) {
			var obj = data;
	        if (obj.status=== true) {
				// Mask the mobile number (show only last 4 digits)
				var maskedMobile = "XXXXXX" + employerMobile.toString().slice(-4);
				document.getElementById("maskedMobileDisplay").innerText = `OTP code has been sent to your phone ${maskedMobile}. Enter OTP to validate issuance.`;				
								
	            // If successful, open the OTP modal
				var timeleft = "60";
				var resendCodeElement = document.getElementById("resendCode");
	               // Hide the "Resend OTP" link initially
	               resendCodeElement.style.display = "none";
				var downloadTimer = setInterval(function() {
					document.getElementById("countdown").innerHTML = "00:"+timeleft;
					timeleft -= 1;
					document.getElementById("orderId").value= obj['orderId'];
					if (timeleft < 0) {
						clearInterval(downloadTimer);
						resendCodeElement.style.display = "block";
						document.getElementById("authenticate").disabled = true;
					}
								}, 1000);
	            $('#otpModal1').fadeIn();
	          } else {
				document.getElementById('submitButton').disabled=false;
	            alert("Error: " + response.message);
	          }
	        },
	        error: function() {
			  //$('#otpModal').fadeIn();
	         // alert("An error occurred. Please try again.");
	        }
	      });
	    });
	  });
	</script>
	
    <script>
        $(document).ready(function () {
            $("#linkBankAccount").click(function () {
                $("#linkedAccount").show();
                $("#nolinkBankAccount").hide();

            });
        });
        $(document).ready(function () {

            $("#selectvouchers").click(function () {
                $("#selectvouchers-wrap02").show();
                $("#selectvouchers-wrap01").hide();
            });

            $("#authenticatereport").click(function () {
                $("#selectvouchers-wrap05").show();
                $(".modal").hide();
                $("#selectvouchers-wrap04").hide();
            });
			
			$("#verifyDetailBack").click(function () {
				
				document.getElementById("issuesfailmsg").innerText="";
				document.getElementById("issuesfailmsgDiv").style.display="none";
				
			    $("#selectvouchers-wrap03").show();
			    $("#selectvouchers-wrap04").hide();
			});
					

            $(".selectMCC").click(function () {
                $("#modalforvccategoryforbulkissuance").show();
            });
        });

     
    </script>

	<script>
	
	function getTotalVoucherCount(){
				var employerid = document.getElementById("employerId").value;
				$.ajax({
					type: "POST",
					url: "/getTotalVoucherCount",
					data: {
						"orgId": employerid,
						"workflowid":100003
					},
					success: function(data) {
						newData = data;
						var data1 = jQuery.parseJSON(newData);
						document.getElementById("totalNumber").innerText=data1.totalCount;
						document.getElementById("totalValue").innerText="â‚¹"+data1.totalAmount;
						
						},
						error: function(e) {
							alert('Failed to fetch JSON data' + e);
					}
				});
			}
				
	</script>
	<script>
	    // Function to format date as YYYY-MM-DD
	    function getFormattedDate(offsetDays = 0) {
	        const date = new Date();
	        date.setDate(date.getDate() + offsetDays); // Adjust for offset days
	        const yyyy = date.getFullYear();
	        const mm = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
	        const dd = String(date.getDate()).padStart(2, '0');
	        return `${yyyy}-${mm}-${dd}`;
	    }

	    // Set minimum and default values
	    document.getElementById('expiryDate').min = getFormattedDate(1);
	    document.getElementById('startDate').min = getFormattedDate();
	    document.getElementById('startDate').value = getFormattedDate(); // Set default value to current date
	</script>

	
	<script>
	    function addNewVoucher(event) {
	        event.preventDefault();

	        const tableBody = document.getElementById('voucherTableBody');

	        // Create a new row
	        const newRow = document.createElement('tr');
	        newRow.innerHTML = `
	            <td>
					<div class="autocomp-input-wrap table-input">
                       <input type="text" class="autocomp-input " id="search" oninput="userSearchAndPupolate()"
                           placeholder="Enter Name" autocomplete="off">
                       <div id="autocomplete-suggestions"
                           class="autocomplete-dropdown"></div>
                   </div>
	            </td>
	            <td>
	                <input type="text" class="table-input" placeholder="Enter Mobile Number">
	            </td>
	            <td>
	                <input type="text" class="table-input table-input-voucher selectMCC" placeholder="Select Voucher" id="btnforvccategoryforbulkissuance">
	            </td>
	            <td>
	                <select class="GeneralSelect">
	                    <option value="General">Choose Type</option>
	                    <option value="Single">Single</option>
	                    <option value="Multi">Multi</option>
	                </select>
	            </td>
	            <td>
	                <input type="text" class="table-input" placeholder="Enter Amount">
	            </td>
	            <td>
	                <input type="date" class="table-dateed" placeholder="Select Date">
	            </td>
	            <td>
	                <select class="GeneralSelect">
	                    <option value="7 days">7 days</option>
	                    <option value="30 days">30 days</option>
	                    <option value="90 days">90 days</option>
	                </select>
	            </td>
	            <td>
	                 <a href="#" onclick="deleteRow(this)"><img src="img/delete.svg" alt=""></a>
	            </td>
	        `;

	        // Insert the new row above the last row
	        tableBody.insertBefore(newRow, tableBody.lastElementChild);
	    }

	    function deleteRow(button) {
			// Get the table body and its rows
			   const tableBody = document.getElementById("voucherTableBody");
			   const rows = tableBody.querySelectorAll("tr");

			   // Log the number of rows
			   console.log("Number of rows before deletion:", rows.length);

			   // Check if only one row is present
			   if (rows.length <= 2) {
			       alert("Cannot delete the first row.");
			       return;
			   }

			   // Delete the selected row
			   const row = button.parentElement.parentElement;
			   tableBody.removeChild(row);

			   // Log the number of rows after deletion
			   console.log("Number of rows after deletion:", tableBody.querySelectorAll("tr").length);
	    }
	</script>
	
	<div id="otpModal1" class="modal customfade">
	    <div class="modal-dialog modal-dialog-centered modal-approval-wrap" role="document">
	        <div class="modal-content modal-bulk">
	            <div class="modal-header pb-0 text-center">
	                <h5 class="modal-title w-100" id="exampleModalCenterTitle">Authentication for Issuance</h5>
	            </div>
	            <div class="modal-body text-center">
	                <div class="otp-box-onboarding justify-content-center">
					
						<input  class="form-control form-control-sm test" type="password" id="password1" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password1" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password2" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password2" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password3" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password3" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password4" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password4" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password5" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password5" maxlength="1" autocomplete="off" onkeypress="focusNext(this)" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="password" id="password6" 
							oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"
					        name="password6" maxlength="1" autocomplete="off" onkeydown="focusBack()">
					        <input  class="form-control form-control-sm test" type="hidden" id="orderId" 
					        name="orderId" >
							<div class="d-flex justify-content-center mt-2">
							    <i class="fa-solid fa-eye" id="toggleOtpIcon2" style="cursor: pointer;margin-top: 5px; " onclick="toggleOtpVisibility2()"></i>
							</div>
	                </div>
	               <label class="time-otp ml-0 text-dark" for="" id="countdown" style="color: green;"></label>
				  <!-- <div class="text-center" id="countdown" style="color: green;"></div>-->
					<p id="resendCode">Didnâ€™t receive the code?  <a href="#" onclick="resendVoucherOTP()">Resend OTP</a></p>
					
					<div class="error-msg" id="otpError" style="color:red"></div>
					
	                <div class="tip-wrap justify-content-center">
	                    <p class="mb-0" id="maskedMobileDisplay" ></p>
	                </div>
					
	                <div class="d-flex justify-content-center mt-3">
						<button class="btn btn-primary w-100" id="authenticate" onclick="verfyIssueVoucherOTP()">Authenticate</button>
	                </div>
	            </div>
	      

    <!-- Modal Choose Type of Advance Request -->
    <div class="modal fade" id="Modal-upivouchers-info" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-approval-wrap modal-lg" role="document">
            <div class="modal-content modal-bulk">
                <div class="modal-header pb-0">
                    <h5 class="modal-title" id="exampleModalCenterTitle">Voucher Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="d-block">
                        <p>These are e-RUPI Vouchers that are person and purpose specific. They can be redeemed using
                            UPI Apps. To learn more, <a href="#"><b>click here.</b></a></p>
                    </div>
                    <div class="specificDetails">
                        <h4>Voucher Specific Details</h4>
                        <p>Category: <strong>Meal</strong></p>
                        <p class="mb-0">Eligible Merchants: <strong>Restaurants, Food Ordering Platforms, Fast
                                Food</strong></p>
                    </div>

                    <div class="specificDetails-white">
                        <h4>Brands Available</h4>
                        <hr>
                        <div class="d-flex">
                            <img src="img/zomato.svg" alt="">
                            <img src="img/swiggy.svg" alt="">
                            <img src="img/dominos.svg" alt="">
                            <img src="img/freshmenu.svg" alt="">
                        </div>
                    </div>

                    <div class="d-flex justify-content-center mt-3">
                        <button class="btn btn-primary w-100">OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
	
</body>

</html>