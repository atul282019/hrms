<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cotodel Login</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background-color: #f4f4f9;
      
    }
	.image-section{max-height: 88svh; overflow: hidden; border-radius: 20px;}

    .form-control {
      margin-bottom: 20px;
    }
    .btn-primary {
      width: 100%;
    }
	
	.login-section {max-height: 88svh; height: 100%;}
	.carousel-line-indicators {
	  display: flex;
	  gap: 12px;
	  justify-content: flex-start;
	}

	.carousel-line-indicators .line {
	  width: 40px;
	  height: 2px;
	  background-color: #ffffff;
	  opacity: 0.8;
	  border-radius: 2px;
	  margin-bottom: 10px;
	}

	.carousel-line-indicators .line.active {
	  background-color: #2F945A;
	  opacity: 1;
	}


  </style>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const carousel = document.getElementById('imageCarousel');
    if (!carousel) return; // optional: fail safe

    const indicators = document.querySelectorAll('.carousel-line-indicators .line');

    indicators.forEach((line, index) => {
      line.addEventListener('click', () => {
        $('#imageCarousel').carousel(index);
      });
    });

    carousel.addEventListener('slid.bs.carousel', () => {
      const activeIndex = [...carousel.querySelectorAll('.carousel-item')]
        .findIndex(item => item.classList.contains('active'));

      document.querySelectorAll('.carousel-line-indicators').forEach(group => {
        group.querySelectorAll('.line').forEach((line, idx) => {
          line.classList.toggle('active', idx === activeIndex);
        });
      });
    });
  });
  </script>
<style>     .carousel-line-indicators {
    display: flex;
    gap: 8px;
  }

  .carousel-line-indicators .line {
    height: 2px;
    width: 20px;
    background-color: #ccc;
    border-radius: 2px;
    transition: width 0.3s ease, background-color 0.3s ease;
  }

  .carousel-line-indicators .line.active {
    width: 30px; /* horizontally bigger */
    background-color: #2F945A;
  }
</style>

</head>
<body>
  <div class="main-container  py-3 overflow-hidden">
	 
			<div class="container-fluid container-xl h-100">
				<div class="row mb-3 justify-content-center">
					<div class="col-md-11 ">
			  <img src="img/Cotodel Logo.svg" alt="Cotodel Logo" class="img-fluid me-auto d-block" />

					</div>
				</div>
				<div class="row justify-content-center h-100">
					<div class="col-lg-7">
					<div class="image-section position-relative   h-100" >
						<div id="imageCarousel" class="carousel slide h-100 overflow-hidden" style="border-radius: 20px;" data-ride="carousel">
							<div class="carousel-inner h-100">
							<div class="carousel-item active h-100" data-index="0">
								<img src="img/Image 1_SignIn.webp" class="img-fluid w-100 h-100" alt="Slide 1" style="object-fit: cover;">
								<div class="carousel-caption d-none d-md-block text-left">
								<div class="carousel-line-indicators mb-2">
									<div class="line active" data-slide-to="0"></div>
									<div class="line" data-slide-to="1"></div>
								</div>
								<h3 style="font-weight: 700;"><span style="color: #2F945A;">Business expenses</span> made seamless like your <span style="color: #2F945A;">personal UPI spends</span></h3>
								</div>
							</div>

							<div class="carousel-item h-100" data-index="1">
								<img src="img/corporate_women_login.webp" class="img-fluid w-100 h-100" alt="Slide 2" style="object-fit: cover;">
								<div class="carousel-caption d-none d-md-block text-left">
								<div class="carousel-line-indicators mb-2">
									<div class="line" data-slide-to="0"></div>
									<div class="line active" data-slide-to="1"></div>
								</div>
								<h3 style="font-weight: 700;"><span style="color: #2F945A;">Business expenses</span> made seamless like your <span style="color: #2F945A;">personal UPI spends</span></h3>
								</div>
							</div>
							</div>
						</div>
						</div>
					</div>
						
					<div class="col-lg-4"> 
			<div class="login-section ">
						
						<div class="login-body">
							<form autocomplete="off" id="loginForm" name="loginForm">
								<h4 class="login-title" style="margin: 0;">Get started with your email or phone number</h4>
								<!-- Flex container: text left, switch right -->
								
								<div >
								<br>									   							
   						   <ul class="nav nav-underline" id="dashboardTabs" role="tablist">
   						     <li class="nav-item">
   						       <a class="nav-link active" data-toggle="tab" href="#LoginwithOTP" role="tab">Login with OTP</a>
   						     </li>
   							 <li class="nav-item">
   						       <a class="nav-link" data-toggle="tab" href="#LoginwithPassword" role="tab">Login with Password</a>
   						     </li>
							
   							
   						   </ul>
   						  
   						   <hr class="mt-0">

   						   <div class="tab-content mt-3">
   							<!--vouchers tab-->
   							<div class="tab-pane fade show active" id="LoginwithOTP" role="tabpanel">
								<div class="phone-input-container mt-3">
								<div class="phone-prefix">
									<img src="https://flagcdn.com/w40/in.png" alt="IN" class="flag-icon" />
									<span>+91</span>
								</div>
								<input class="form-control phone-input" placeholder="Enter Your Mobile No." type="text" id="mobile" name="mobile"
								autocomplete="off" maxlength="10" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
								</div>
								<div class="error-msg" id="mobError" ></div>
								<div  class="error-msg" id="errorOtp" ></div>	
								<!--<br>
								<div id="showhideotpSwitch"style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">

								 
								  <span style="color: #6D7072;">Login with OTP</span>

								 
								  <div class="custom-tooltip-wrapper" data-tooltip="Login with password">
								    <label class="custom-switch">
								      <input type="checkbox" id="loginToggle">
								      <span class="custom-slider"></span>
								    </label>
								  </div>

								  
								  <span style="color: #6D7072;">Login with password</span>
								</div>-->
								<p class="helper-text">We will send an OTP on the mobile number entered.</p>

								<!-- Custom Switch Styles -->
								<!-- Styles -->




								<!-- Inside .login-section -->
								<div class="login-body" id="login-body">
								<!-- Your phone input and login UI -->
								<!-- Replace LOGIN button -->
								<button class="btn login-btn" onclick="getOTP();"  id="optBtn" type="button" disabled >Send OTP</button>
								</div>

								

								<!-- OTP Form -->
								<div id="otp-section" style="display:none;">
								<h4 class="login-title">Enter OTP</h4>
								<!--<p class="helper-text">OTP code has been sent to your phone <strong>xx405</strong></p>-->
								<span id="maskedMobileDisplay"></span>

								<div id="otpInputBox" >
								<div class="d-flex justify-content-between mb-3 " style="margin-top: 15px;">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off" 
									id="password1" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password1">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off"  
									id="password2" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password2">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off"
									id="password3" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password3">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off" 
									id="password4" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password4">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off" 
									id="password5" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password5">
									<input type="password" class="form-control text-center otp-input" maxlength="1" autocomplete="off"  
									id="password6" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\.*)\./g, '$1');"name="password6">
									<input  class="form-control form-control-sm test" type="hidden" id="orderId" name="orderId" >
																							
									<div>
																								
									<input type="hidden" id="errorMessage" th:value="${message}" ></input>
									<input type="hidden" id="mo" th:value="${mobile}" ></input>
									<input type="hidden" id="orderid" th:value="${orderid}" ></input>
										
								</div>		
								<span id="toggleOtpVisibility" onclick="toggleOtpVisibility()" class="eye-icon" role="button" aria-label="Toggle OTP visibility" tabindex="0">
									<i class="fas fa-eye"></i>
									</span>
									</div>
								</div>
								<div  class="error-msg" id="otpError" style="margin-top: -15px; margin-bottom: 20px;"></div>	
									
								<p id="otpCountdownText">
									You can resend the OTP after: 
									<span id="countdown" style="color: green;"></span> seconds
								</p>

								<p class="text-muted" id="resendOTPText" style="display: none; ">Didn’t receive the code? <a href="#" onclick="resendOTP()">Resend OTP</a></p>
								<!--<button class="btn login-btn">LOGIN</button>-->
								<button type="button"  style="display:none" onclick="submitAction()" id="verifyotpdiv" class="btn login-btn" disabled>LOGIN</button>
								</div>
								</form>
   							</div>

   							 
   							<!-- LoginwithPassword tab-->
   						     <div class="tab-pane fade" id="LoginwithPassword" role="tabpanel">
								<!-- login without otp-->
								<div class="login-body" id="directloginbody">
									<form id="pwdForm" method="post" name="pwdForm"> 
									<div class="did-floating-label-content">
									  <input class="did-floating-input" type="text" id="dynamicInput" name="mobile" placeholder=" ">
									  <label id="dynamicLabel" class="did-floating-label">Mobile Or Email<span class="required-star"></span></label>
									</div>
								<div class="did-floating-label-content">
								    <input class="did-floating-input" type="password" id="pwd" name="pwd"
								        placeholder=" ">
								    <label class="did-floating-label">Password<span class="required-star"></span></label>
									 <span toggle="#pwd" class="fa fa-fw fa-eye field-icon toggle-password" id="togglePassword" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></span>
								</div>
								</form>

								<div class="links-container" style="text-align: right; margin-bottom: 10px;">
								  <a href="#"  onclick="handleForgotPassword(event)"  style="color:#367AFF; margin-right:10px; font-size: 13px;">Forgot Password?</a>
								  <a href="#"  onclick="selectOtpLogin()" style="color:#367AFF; font-size: 13px;">Login with OTP</a>
								</div>
								
								<div  class="error-msg" id="loginerrorMsg" ></div>	
								<button class="btn login-btn"   id="directlogin" onclick="loginwithPwd()" type="button" disabled>Login</button>
								</div><!-- login without otp ends here-->
   																		
   						     </div>
   							

		   </div>
		 </div>


							
							<div class="or-divider">
							<!--	<span>or login with</span>-->
							</div>

							<div class="social-buttons">
								<!--<button class="btn social-btn"><img src="https://img.icons8.com/color/24/google-logo.png" alt="Google" />
									Google</button>
								<button class="btn social-btn"><img src="img/repute-logo.png" alt="Repute" /> Repute</button>-->
							</div>
						</div>
						

						<hr class="footer-divider" />
						<div class="login-footer">
							New to Cotodel? <a href="/Industries">Register for Demo</a>
						</div>
						
						<!-- Forgot Password Section -->
						<div id="forgotPasswordSection" style="display:none;">

						  <h4 class="mb-4" style="font-weight:600;">Setup your Password</h4>

						  <!-- Enter Password
						  <div class="form-group position-relative">
						    <input type="password" id="newPassword" class="form-control" placeholder="Enter Password" />
						    <span toggle="#newPassword" class="fa fa-fw fa-eye field-icon toggle-password"
						          onclick="togglePasswordVisibility('newPassword', this)"
						          style="position: absolute; right: 12px; top: 20px; cursor: pointer;"></span>
						  </div> -->
						  <div class="form-group position-relative">
						    <input type="password" id="newPassword" class="form-control" placeholder="Enter Password" />
						    <span id="passwordStrength" 
						          style="position:absolute; right:40px; top:12px; font-size:14px; font-weight:600;">
						    </span>
						    <span toggle="#newPassword" class="fa fa-fw fa-eye field-icon toggle-password"
						          onclick="togglePasswordVisibility('newPassword', this)"
						          style="position: absolute; right: 12px; top: 20px; cursor: pointer;"></span>
						  </div>

						  <!-- Password rules -->
						  <div class="d-flex flex-wrap mb-3" style="gap:10px; font-size:14px; color:#6D7072;">
						    <span id="upperReq">1 uppercase character</span>
						    <span id="lowerReq">1 lowercase character</span>
						    <span id="numReq">1 number</span>
						    <span id="specialReq">1 special character</span>
						    <span id="lengthReq">8-15 characters</span>
						  </div>


						  <!-- Confirm Password -->
						  <div class="form-group position-relative">
						    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm Password" />
						    <span toggle="#confirmPassword" class="fa fa-fw fa-eye field-icon toggle-password"
						          onclick="togglePasswordVisibility('confirmPassword', this)"
						          style="position: absolute; right: 12px; top: 20px; cursor: pointer;"></span>
						  </div>
						  <!-- Password match message -->
						  <div id="passwordMatchMsg" style="font-size:14px; display:none; margin-top:-10px; margin-bottom:15px;"></div>
						  <!-- Submit 
						  <button id="setupPasswordBtn" class="btn btn-primary w-100" type="button" disabled
						          style="background:#EAF0FF; border:none; color:#367AFF; font-weight:600; padding:10px; border-radius:8px;">
						    SETUP PASSWORD
						  </button>-->
						  <button class="btn login-btn"   id="setuppassword" onclick="setPassword()"  type="button" disabled>SETUP PASSWORD</button>
						</div>
						  <!--<div class="text-center mt-4">
						    <small>New to Cotodel? <a href="/Industries" style="color:#367AFF;">Register for Demo</a></small>
						  </div>-->
						</div>

						
						<div class="lds-spinner" id="loginLoader" style="display:none"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>

						</div>
				</div>
						
		     </div>
			</div>
	
			
  </div>
 
  <link rel="stylesheet" href="css/custom-neha.css">
  <!-- Bootstrap core JavaScript-->
      <script src="vendor/jquery/jquery.min.js"></script>
      <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

      <!-- Core plugin JavaScript-->
     <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

      <!-- Custom scripts for all pages-->
      <script src="js/sb-admin-2.min.js"></script>
 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="cotodel-js/mobileotp.js"></script>
  <style>  .rule-icon {
    width: 16px;
    height: 16px;
    margin-right: 6px;
    vertical-align: middle;
  }
</style>
<script>
  const passwordInput1 = document.getElementById("pwd");
  const loginButton = document.getElementById("directlogin");

  passwordInput1.addEventListener("input", function () {
    if (passwordInput1.value.trim() !== "") {
      loginButton.disabled = false;
    } else {
      loginButton.disabled = true;
    }
  });
</script>

  <script>  
	function selectOtpLogin() {
	  // Switch to OTP tab using Bootstrap
	  $('#dashboardTabs a[href="#LoginwithOTP"]').tab('show');
	}

	// Toggle password visibility
  function togglePasswordVisibility(id, el) {
    const input = document.getElementById(id);
    if (input.type === "password") {
      input.type = "text";
      el.classList.remove("fa-eye");
      el.classList.add("fa-eye-slash");
    } else {
      input.type = "password";
      el.classList.remove("fa-eye-slash");
      el.classList.add("fa-eye");
    }
  }
  function handleForgotPassword(event) {
    event.preventDefault();

    const mobileOrEmail = document.getElementById("dynamicInput").value.trim();

    // Check if it's a valid 10-digit mobile number
    const mobileRegex = /^[6-9]\d{9}$/;

    if (!mobileOrEmail || !mobileRegex.test(mobileOrEmail)) {
      // Show error under input
      document.getElementById("loginerrorMsg").textContent = "Please enter a valid mobile number first";
      setTimeout(() => {
        document.getElementById("loginerrorMsg").textContent = "";
      }, 4000);
      return;
    }

    // ✅ If valid mobile → go to Forgot Password flow
    showForgotPassword();
  }

  // Validation
  const passwordInput = document.getElementById("newPassword");
  const confirmInput = document.getElementById("confirmPassword");
  const setupBtn = document.getElementById("setuppassword"); // <-- fix ID

  passwordInput.addEventListener("input", validatePassword);
  confirmInput.addEventListener("input", validatePassword);

  function validatePassword() {
    const password = passwordInput.value;
    const confirm = confirmInput.value;

    const upper = /[A-Z]/.test(password);
    const lower = /[a-z]/.test(password);
    const number = /\d/.test(password);
    const special = /[@$!%*?&#]/.test(password);
    const length = password.length >= 8 && password.length <= 15;

    const rulesPassed = [upper, lower, number, special, length].filter(Boolean).length;

    updateRule("upperReq", upper);
    updateRule("lowerReq", lower);
    updateRule("numReq", number);
    updateRule("specialReq", special);
    updateRule("lengthReq", length);

    updateStrength(rulesPassed);

    // ✅ Enable only if all rules pass AND confirm matches
    const allRulesPassed = rulesPassed === 5;
    const passwordsMatch = password && password === confirm;

    setupBtn.disabled = !(allRulesPassed && passwordsMatch);
    setupBtn.style.background = setupBtn.disabled ? "#EAF0FF" : "#367AFF";
    setupBtn.style.color = setupBtn.disabled ? "#367AFF" : "#fff";
	
	const matchMsg = document.getElementById("passwordMatchMsg");
	  if (passwordsMatch) {
	    matchMsg.style.display = "block";
	    matchMsg.innerHTML = `<img src="img/check-circle-fullgreen.png" 
	                             style="width:16px; height:16px; margin-right:6px; vertical-align:middle;">
	                          <span style="color:#2F945A;">Password matched successfully</span>`;
	  } else {
	    matchMsg.style.display = "none";
	  }
  }

  function updateRule(ruleId, isValid) {
    const rule = document.getElementById(ruleId);

    if (isValid) {
      if (!rule.querySelector("img")) {
        const img = document.createElement("img");
        img.src = "img/check-circle-fullgreen.png";
        img.classList.add("rule-icon");
        rule.prepend(img);
      }
      rule.style.color = "#2F945A";
    } else {
      const img = rule.querySelector("img");
      if (img) img.remove();
      rule.style.color = "#6D7072";
    }
  }

  function updateStrength(rulesPassed) {
    const strengthEl = document.getElementById("passwordStrength");

    if (rulesPassed <= 2) {
      strengthEl.textContent = "Weak";
      strengthEl.style.color = "#FF545A";
    } else if (rulesPassed >= 3 && rulesPassed < 5) {
      strengthEl.textContent = "Medium";
      strengthEl.style.color = "#FEBC2F";
    } else if (rulesPassed === 5) {
      strengthEl.textContent = "Strong";
      strengthEl.style.color = "#367AFF";
    } else {
      strengthEl.textContent = "";
    }
  }



</script>
  <script>
	function showForgotPassword() {
		document.querySelector(".footer-divider").style.display = "none";
		document.querySelector(".social-buttons").style.display = "none";
		document.querySelector(".login-footer").style.display = "none";
	  document.querySelector(".or-divider").style.display = "none";
	  document.querySelector(".login-body").style.display = "none";
	  document.getElementById("forgotPasswordSection").style.display = "block";
	}

	
    const togglePassword = document.querySelector("#togglePassword");
    const passwordField = document.querySelector("#pwd");

    togglePassword.addEventListener("click", function () {
      const type = passwordField.getAttribute("type") === "password" ? "text" : "password";
      passwordField.setAttribute("type", type);
      if (type === "text") {
        this.classList.remove("fa-eye");
        this.classList.add("fa-eye-slash");
      } else {
        this.classList.remove("fa-eye-slash");
        this.classList.add("fa-eye");
      }
    });
	
	
		
  </script>



  <script>
	/* script to toggle the label for mobile/email in password section*/
    const input = document.getElementById("dynamicInput");
    const label = document.getElementById("dynamicLabel");

    input.addEventListener("input", () => {
      const value = input.value.trim();

      if (/^[0-9]+$/.test(value)) {
        label.innerHTML = "Mobile<span class='required-star'></span>";
      } else if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
        label.innerHTML = "Email<span class='required-star'></span>";
      } 
    });
  </script>
  <script>
    $('#imageCarousel').carousel({
      interval: 10000, // 10 seconds per slide
      ride: 'carousel'
    });
  </script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const mobileInput = document.getElementById("mobile");
    const optBtn = document.getElementById("optBtn");

    mobileInput.addEventListener("input", function () {
      const isValid = /^[6-9]\d{9}$/.test(mobileInput.value);
      optBtn.disabled = !isValid;
    });
  });
  </script>
  <script>
	/* when user finishes entering otp then only enable login button*/
	document.querySelectorAll('.otp-input').forEach(input => {
	   input.addEventListener('input', checkOtpFilled);
	 });

	 function checkOtpFilled() {
	   const inputs = document.querySelectorAll('.otp-input');
	   const allFilled = Array.from(inputs).every(input => input.value.trim().length === 1);

	   const verifyBtn = document.getElementById('verifyotpdiv');
	   verifyBtn.disabled = !allFilled;
	 }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const otpInputs = document.querySelectorAll(".otp-input");
   
      otpInputs.forEach((input, index) => {
        input.addEventListener("input", function () {
          if (this.value.length === 1) {
            const next = otpInputs[index + 1];
            if (next) next.focus();
          }
        });
   
        input.addEventListener("keydown", function (e) {
          if (e.key === "Backspace" && this.value === "") {
            const prev = otpInputs[index - 1];
            if (prev) prev.focus();
          }
        });
      });
    });
    </script>
	<script>	$( document ).ready(function() {

		var error = document.getElementById("errorMessage").value;
		var mo = document.getElementById("mo").value;
		
		var orderid = document.getElementById("orderid").value;
		var maskedMobile = "XXXXXX" + mo.toString().slice(-4);
		

		console.log("Error msg after hitting the login",error);
		if(error==="Invalid Request !!"){
	    document.getElementById("loginIdDiv").style.display="none";
	    document.getElementById("optBtn").style.display="block";
	    } 
		else if(error==="FAILURE" || error==="User not found or inactive")
{				const toggle = document.querySelector(".custom-switch input");
				toggle.checked = true; // Switch ON
			// in case of wrong password
			const phoneLogin = document.getElementById("login-body");
			phoneLogin.style.display =  "none" ;
			const passwordLogin = document.getElementById("directloginbody");
			passwordLogin.style.display =  "block" ;
			const helperText = document.querySelector(".helper-text");
			helperText.style.display =  "none" ;
			if(error==="FAILURE" )
			{
				$('#loginerrorMsg').text("Please Enter Correct Password");
				setTimeout(function() {
				  $('#loginerrorMsg').text("");// clear the msg after 6 sec
				}, 7000); // 10 seconds
			}
			else if(error==="User not found or inactive")
			{
				$('#loginerrorMsg').text("User not found or inactive");
					setTimeout(function() {
					  $('#loginerrorMsg').text("");// clear the msg after 6 sec
					}, 7000); // 10 seconds
			}
		}
		else if(error==="Incorrect OTP ||"){
			//hide otp button and helper text above it 
			$("#optBtn").hide();
			$(".helper-text").hide();
			//show the otp section
			$("#otp-section").show();
			// apply the border in custom colour to 
			$(".otp-input").addClass("error");
			//show the otp msg
			 $("#otpError").text("Invalid OTP. Please try again.");
			  document.getElementById("maskedMobileDisplay").innerHTML = `OTP code has been sent to your phone ${maskedMobile}`;
			//  $("#orderId").val(orderid);
			        $("#verifyotpdiv").show();
			  var expiryTime = localStorage.getItem("otpExpiryTime");
			  var downloadTimer = setInterval(function () {
			          var currentTime = Date.now();
			          var timeleft = Math.floor((expiryTime - currentTime) / 1000);

			          if (timeleft <= 0) {
			              clearInterval(downloadTimer);
						  document.getElementById("otpCountdownText").style.display = "none";
			              localStorage.removeItem("otpExpiryTime");
			              document.getElementById("countdown").innerHTML = " ";
			              document.getElementById("resendOTPText").style.display = "block";
			              document.getElementById("optBtn").disabled = false;
			              document.getElementById("verifyotpdiv").style.display = "none";
			          } else {
			              var minutes = Math.floor(timeleft / 60);
			              var seconds = timeleft % 60;
			              document.getElementById("countdown").innerHTML =
			                  (minutes < 10 ? "0" + minutes : minutes) + ":" +
			                  (seconds < 10 ? "0" + seconds : seconds);
			          }
			      }, 1000);
			  document.getElementById("mobile").value=mo;
			  document.getElementById("orderId").value=orderid;
			  document.getElementById("loginIdDiv").style.display="block";
			  document.getElementById("optBtn").style.display = "none";
			  document.getElementById("verifyotpdiv").style.display = "block";
			 
			 // window.location.href="/login";
		}
		else if(error==="No Role assigned to User. Please contact to Organisation Admin !!"){
			document.getElementById("loginIdDiv").style.display="none";
		    document.getElementById("optBtn").style.display="block";
		}else{
			
		}
		//clear otp boxes
		//$(".otp-input").val('');
	});</script>
   <script>	function getOTP() {
	//clear otp boxes
	//$(".otp-input").val('');

		console.log("get otp called");
	    var regMobile = /^[6-9]\d{9}$/gi;
	    var userName = document.getElementById("mobile").value;

	    if (userName == "") {
	        document.getElementById("mobile").focus();
	        document.getElementById("mobError").innerHTML = "Please Enter Mobile Number";
	        return false;
	    } else if (userName.length < 10) {
	        document.getElementById("mobError").innerHTML = "Please Enter Valid Mobile Number";
	        document.getElementById("mob").focus();
	        return false;
	    } else if (!userName.match(regMobile)) {
	        document.getElementById("mobError").innerHTML = "Please Enter Valid Mobile Number";
	        document.getElementById("mob").focus();
	        return false;
	    }

	    document.getElementById("optBtn").disabled = true;
	    document.getElementById("mobError").innerHTML = "";
	    document.getElementById("loginLoader").style.display = "flex";
		
	 
	    $.ajax({
	        type: "POST",
	        url: "/smsOtpSender",
	        dataType: 'json',
	        data: { "mobile": userName },
	        success: function (data) {
	            var obj = data;
	            document.getElementById("loginLoader").style.display = "none";

	            if (obj.status === true) {
					document.getElementById('login-body').style.display = 'none';
				    document.getElementById('otp-section').style.display = 'block';

				    document.querySelector('.or-divider').style.display = 'none';
				    document.querySelector('.social-buttons').style.display = 'none';
				    
				    
					document.querySelector('.helper-text').style.display = 'none';
									
					// Mask the mobile number (show only last 4 digits)
					var maskedMobile = "XXXXXX" + userName.toString().slice(-4);
					document.getElementById("maskedMobileDisplay").innerHTML = `OTP code has been sent to your phone ${maskedMobile}`;

	                $('#errorOtp').hide('slow');
	                $('#loginIdDiv').hide('slow');
					document.getElementById("verifyotpdiv").style.display = "block";
					var timeleft = 60; // 3 minutes in seconds
					   var downloadTimer = setInterval(function () {
					       var minutes = Math.floor(timeleft / 60); // Calculate minutes
					       var seconds = timeleft % 60; // Calculate remaining seconds

					       // Update countdown display in "MM:SS" format
					       document.getElementById("countdown").innerHTML = 
					           (minutes < 10 ? "0" + minutes : minutes) + ":" + 
					           (seconds < 10 ? "0" + seconds : seconds);

					       timeleft -= 1;
						   localStorage.setItem("otpExpiryTime", Date.now() + seconds * 1000);   
						   document.getElementById("optBtn").style.display = "none";
						   document.getElementById("orderId").value = obj['orderId'];
						   
						   
					       if (timeleft < 0) {
							clearInterval(downloadTimer);
							document.getElementById("otpCountdownText").style.display = "none";
	                        document.getElementById("countdown").innerHTML = " ";
							document.getElementById("resendOTPText").style.display = "block";
	                     
	                        document.getElementById("optBtn").disabled = true;
							document.getElementById("optBtn").style.display = "none";
	                        document.getElementById("verifyotpdiv").style.display = "none";
							
					       }
					   }, 1000); 

	                $('#loginIdDiv').show('slow');
	            } else if (obj.status===false) {
	                $('#errorOtp').html(obj.message);
	                $('#successmessage').hide('slow');
	                document.getElementById("optBtn").style.display = "block";
	                document.getElementById("optBtn").disabled = false;
	                $('#successerror').hide('slow');
	            } else {
	                $('#errorOtp').html("OTP Failed");
	                document.getElementById("optBtn").disabled = false;
	                $('#successmessage').hide('slow');
	                document.getElementById("optBtn").style.display = "block";
	                $('#successerror').hide('slow');
	            }
	        },
	        error: function (e) {
				document.getElementById("optBtn").disabled = false;
				document.getElementById("optBtn").style.display = "block";
				document.getElementById("loginLoader").style.display = "none";
	            alert('Error: ' + "Connection Timeout");
				
	        }
	    });
	}</script>
	
<script>	function resendOTP() {
		
	    console.log("resend otp clicked");
		document.getElementById("password1").value = "";
		document.getElementById("password2").value = "";
		document.getElementById("password3").value = "";
		document.getElementById("password4").value = "";
		document.getElementById("password5").value = "";
		document.getElementById("password6").value = "";
	    var regMobile = /^[6-9]\d{9}$/gi;
	    var userName = document.getElementById("mobile").value;
	    var orderId = document.getElementById("orderId").value;

	    if (userName == "") {
	        document.getElementById("mobile").focus();
	        document.getElementById("mobError").innerHTML = "Please Enter Mobile Number";
	        return false;
	    } else if (userName.length < 10) {
	        document.getElementById("mobError").innerHTML = "Please Enter Valid Mobile Number";
	        document.getElementById("mobile").focus();
	        return false;
	    } else if (!userName.match(regMobile)) {
	        document.getElementById("mobError").innerHTML = "Please Enter Valid Mobile Number";
	        document.getElementById("mob").focus();
	        return false;
	    }

	    document.getElementById("optBtn").disabled = true;
	    document.getElementById("mobError").innerHTML = "";
	    document.getElementById("resendOTPText").style.display = "none"; // Hide Resend OTP link
	    document.getElementById("loginLoader").style.display = "flex";
		document.getElementById("verifyotpdiv").style.display = "block";
		document.getElementById("otpCountdownText").style.display = "block";

	    $.ajax({
	        type: "POST",
	        url: "/smsOtpResender",
	        dataType: 'json',
	        data: { "mobile": userName, "orderId": orderId },
	        success: function (data) {
	            var obj = data;
	            document.getElementById("loginLoader").style.display = "none";

	            if (obj['status'] == true) {
					
					var maskedMobile = "XXXXXX" + userName.toString().slice(-4);
					document.getElementById("maskedMobileDisplay").innerHTML = `Enter the OTP send to ${maskedMobile}`;
	                $('#errorOtp').hide('slow');
	               // document.getElementById("countdown").innerHTML = "00:60"; // Reset countdown
	               // startCountdown(); // Restart the countdown logic
				   var timeleft = 60; // 3 minutes in seconds
				   var downloadTimer = setInterval(function () {
				       var minutes = Math.floor(timeleft / 60); // Calculate minutes
				       var seconds = timeleft % 60; // Calculate remaining seconds

				       // Update countdown display in "MM:SS" format
				       document.getElementById("countdown").innerHTML = 
				           (minutes < 10 ? "0" + minutes : minutes) + ":" + 
				           (seconds < 10 ? "0" + seconds : seconds);

				       timeleft -= 1;
					   localStorage.setItem("otpExpiryTime", Date.now() + seconds * 1000);   
					   document.getElementById("optBtn").style.display = "none";
					   document.getElementById("orderId").value = obj['orderId'];
					   document.getElementById("verifyotpdiv").style.display = "block";

				       if (timeleft < 0) {
						clearInterval(downloadTimer);
						document.getElementById("otpCountdownText").style.display = "none";
	                       document.getElementById("countdown").innerHTML = " ";
						document.getElementById("resendOTPText").style.display = "block";
	                    
	                       document.getElementById("optBtn").disabled = true;
						document.getElementById("optBtn").style.display = "none";
	                       document.getElementById("verifyotpdiv").style.display = "none";
				       }
				   }, 1000); 

	            } else {
	                $('#errorOtp').html(obj['msg']);
	                document.getElementById("resendOTPText").style.display = "block";
	                document.getElementById("optBtn").disabled = true;
					document.getElementById("verifyotpdiv").style.display = "none";
					document.getElementById("otpCountdownText").style.display = "none";
	            }
	        },
	        error: function (e) {
	            alert('Error: ' + e);
	        }
	    });
	}</script>
  <script>
  				  function showOtpForm() {
					
  				    document.getElementById('login-body').style.display = 'none';
  				    document.getElementById('otp-section').style.display = 'block';

  				    document.querySelector('.or-divider').style.display = 'none';
  				    document.querySelector('.social-buttons').style.display = 'none';
  				    
  				    
  					document.querySelector('.helper-text').style.display = 'none';
					
					
  				  }
  				</script>
				<script>				function toggleOtpVisibility() {
				    const toggleIcon = document.getElementById('toggleOtpVisibility').querySelector('i');
				    const otpInputs = document.querySelectorAll('#otpInputBox input.otp-input');

				    const isPasswordVisible = toggleIcon.classList.contains("fa-eye");

				    otpInputs.forEach(input => {
				        input.type = isPasswordVisible ? "text" : "password";
				    });

				    toggleIcon.classList.toggle("fa-eye");
				    toggleIcon.classList.toggle("fa-eye-slash");
				}
</script>
</body>
</html>
