<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	
 <th:block th:include="fragments/headerlibs.html :: headerlibs"></th:block> 

<body id="page-top" onload="getVoucherList(),getSavedVoucherList()">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        
        <div th:insert="fragments/sidenav.html :: sidevav"></div>
        
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content"> 

                <!-- Topbar -->
              
               <!--<div th:insert="fragments/header.html :: header"></div>-->
			   <nav class="navbar navbar-expand navbar-light bg-white topbar static-top">

                   <!-- Topbar Navbar -->
                   <ul class="navbar-nav top-nav">

                       <!-- Nav Item - User Information -->
                       <li class="nav-item">
                           <a class="nav-link active" href="#">
                               <span class="mr-2 small">Dashboard</span>
                               <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                           </a>
                       </li>
                       <li class="nav-item">
                           <a class="nav-link" href="#">
                               <span class="mr-2 small">Request Voucher</span>
                               <i class="fas fa-ellipsis-v fa-sm fa-fw"></i>
                           </a>
                       </li>

                   </ul>

				   <!-- Right Icons + Profile -->
				   			    <ul class="navbar-nav d-flex flex-row align-items-center mb-0">
				   			      <!-- Wallet Icon -->
				   			     <!-- <li class="nav-item mr-3">
				   			        <a href="/settings/wallet" role="button">
				   			          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
				   			        </a>
				   			      </li>-->
				   				  <li class="nav-item mr-3">
				     			        <a href="/cotowallet" role="button">
				     			          <img src="img/Wallet-icon.png" alt="Wallet" class="nav-icon-img" >
				     			        </a>
				     			      </li>
				   			      <!-- Notification Icon -->
				   			      <li class="nav-item mr-3">
				   			        <a href="#" role="button">
				   			          <img src="img/Notification-icon.png" alt="Notification" class="nav-icon-img">
				   			        </a>
				   			      </li>

				   			      <!-- Profile Dropdown -->
				   			      <li class="nav-item dropdown no-arrow">
				   			        <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
				   			          <img class="img-profile rounded-circle" src="img/undraw_profile.svg" alt="User" style="width: 32px; height: 32px;">
				   			        </a>
				   			        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
				   			          <a class="dropdown-item" href="/ProfileInfo">
				   			            <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Profile
				   			          </a>
				   			       <!--   <a class="dropdown-item" href="#">
				   			            <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> Settings
				   			          </a>-->
				   			          <div class="dropdown-divider"></div>
				   			          <a class="dropdown-item" href="/logout">
				   			            <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout
				   			          </a>
				   			        </div>
				   			      </li>
				   			    </ul>	
                     </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
				<div class="policies-wrap-in-table mt-5 mt-4">
						<div class="table-responsive">
							<table class="table table-reimbursements"
								id="reimbursementTable">
								<thead>
									<tr>
										<th>Name</th>
										<th>Mobile No</th>
									<!--	<th>Employee Id</th>-->
										<th>Voucher Type</th>
										<th>Voucher Sub Type</th>
										<th>Voucher Amount</th>
										<th>Creation Date</th>
										<th>Validity In Days</th>
										<th>Remarks</th>
										<th>Status</th>
										
									</tr>
								</thead>
								<tbody>
									<td></td>

								</tbody>
								<tfoot>
				                <tr>
				                    <td colspan="12">
				                        <div class="last-add" style="padding: .75rem;">
				                            <a href="#" class="add-ctgry" data-toggle="modal" data-target="#ModalRequestVoucher">
				                                + Request Voucher
				                            </a>
				                        </div>
				                    </td>
				                </tr>
				            </tfoot>
							</table>
							<!--<div class="last-add">
								<div colspan="9" style="padding: .75rem;">
									<a href="#" class="add-ctgry" data-toggle="modal"
									data-target="#ModalRequestVoucher">+ Request Voucher</a>
								</div>
							</div>-->
						</div>
					</div>
					<div class="lds-spinner" id="signinLoader" style="display: none">
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
													<div></div>
												</div>
				</div>
              
              <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->
        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

<div class="lds-spinner" id="signinLoader" style="display:none"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/demo/datatables-demo.js"></script>

	<script type="text/javascript" src="cotodel-js/requestVoucher.js"></script>
	<style>
	.label-wrapper {
	    display: flex;
	    align-items: center;
	    gap: 4px;
	}
	.required-star {
	    color: red;
	    flex-shrink: 0;
	}
	</style>

	<script type="text/javascript">
	
	$(document).ready(function(){
		
		  $('li.active').removeClass('active').removeAttr('aria-current'); 
		  $('a[href="' +'/requestVoucher"]').closest('li').addClass('active').attr('aria-current', 'page');   
		  
	   $(".innernav").click(function(){
	       $(".dropdownNav").addClass("active");
	   });
	});
	
	</script>
	
	<script>
	    function getVoucherSubTypes() {
	        const selectedVoucherCode = document.getElementById('VoucherType').value;
	        const subTypeDropdown = document.getElementById('VoucherSubType');
	        
	        if (!selectedVoucherCode) {
	            subTypeDropdown.innerHTML = '<option value="">Select Voucher Sub Type</option>';
	            return;
	        }

	        $.ajax({
	            type: "GET",
	            url: "/getPurposeListByVoucherCode",
	            data: { purposeCode: selectedVoucherCode },
	            success: function (data) {
	                const parsedData = jQuery.parseJSON(data);
					console.log("parsed data for /getPurposeListByVoucherCode",parsedData);
	                
	                subTypeDropdown.innerHTML = '<option value="">Select Voucher Sub Type</option>';
	                
	                parsedData.data.forEach(item => {
	                    const option = document.createElement('option');
	                    option.value = item.mcc;
	                    option.textContent = item.mccDesc;
	                    subTypeDropdown.appendChild(option);
	                });
	            },
	            error: function (e) {
	                alert('Error: ' + e.responseText);
	            }
	        });
	    }
	</script>

			<div class="modal fade" id="ModalRequestVoucher" tabindex="-1" role="dialog" aria-labelledby="ModalRequestVoucherTitle" aria-hidden="true">
			    <div class="modal-dialog modal-lg modal-dialog-centered" role="document" >
			        <div class="modal-content" >
			            <div class="modal-header pb-0">
			                <h5 class="modal-title" id="ModalRequestVoucherTitle">Request Voucher</h5>
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			                    <span aria-hidden="true">&times;</span>
			                </button>
			            </div>
			            <div class="modal-body" >
			                
			                <div class="container-fluid p-0 p-md-1">
			                    <form id="requestVoucher" name="requestVoucher" method="post">
			                        <input type="hidden" class="form-input" id="Name" name="Name" th:value="${session.username}">
			                        <input type="hidden" class="form-input" id="employerId" name="employerId" th:value="${session.id}">
			                        <input type="hidden" class="form-input" id="empId" name="empId" th:value="${session.empId}">

									<div class="card-form my-3">
									    <label for="VoucherType" class="label-wrapper">
									        
									        <span>Voucher Type</span>
											<span class="required-star">*</span>
									    </label>
									    <select class="form-select form-control no-bg border-0" id="VoucherType" name="VoucherType" onchange="getVoucherSubTypes()">
									        <option value="">Select Voucher Type</option>
									    </select>
									</div>

			                        <div class="error-msg" id="VoucherTypeerror" style="color:red"></div>
									
									
			                        <div class="card-form my-3">
										<label for="VoucherSubType" class="label-wrapper">
										        
										        <span>Voucher Sub Type</span>
												<span class="required-star">*</span>
										    </label>
			                            <select class="form-select form-control no-bg border-0" id="VoucherSubType" name="VoucherSubType" >
			                                <option value="">Select Voucher Sub Type</option>
			                            </select>
			                        </div>
			                        <div class="error-msg" id="VoucherSubTypeerror" style="color:red"></div>

									<div class="card-form my-3">
                                         <label for="mobno">Mobile Number</label>
										 <input type="text" class="form-input" id="maskedMobno"  
										            th:value="${#strings.length(session.mobile) > 6 ? 'XXXXXX' + session.mobile.substring(6) : session.mobile}" 
										            readonly>

										     <!-- Hidden input to store the actual mobile number for form submission -->
										     <input type="hidden" id="mobno" name="mobno" th:value="${session.mobile}">

                                     </div>
 										 <div class="error-msg" id="mobnoError" style="color:red"></div>
										 
			                        <div class="card-form my-3">
			                            <label for="VoucherAmount">Voucher Amount<span class="required-star">*</span></label>
			                            <input type="text" class="form-input" id="VoucherAmount" name="VoucherAmount" maxlength="5">
			                        </div>
			                        <div class="error-msg" id="VoucherAmountError" style="color:red"></div>
									
									<div class="card-form my-3">
									  <label for="Validity" class="label-wrapper">
									    <span>Validity (in days)</span>
									    <span class="required-star">*</span>
									  </label>
									  <select class="form-select form-control no-bg border-0" id="validity" name="validity">
									    <option value="">Select Validity</option>
									    <option value="7">7</option>
									    <option value="15">15</option>
									    <option value="30">30</option>
									    <option value="90">90</option>
									  </select>
									</div>

			                        <div class="card-form my-3">
			                            <label for="VoucherRemarks">Remarks<span class="required-star">*</span></label>
			                            <input type="text" class="form-input" id="VoucherRemarks" name="VoucherRemarks">
			                        </div>
			                        <div class="error-msg" id="VoucherRemarksError" style="color:red"></div>

			                        

									<div class="modal-footer d-flex justify-content-between ">
										<div id="otmsgdiv" style="display:none" class="alert alert-success text-center">
				                            <div id="otsuccmsg"></div>
				                        </div>

				                        <div id="otfailmsgDiv" style="display:none" class="alert alert-danger text-center">
				                            <div id="otfailmsg"></div>
				                        </div>
									                <button type="button" class="btn btn-primary"  onclick="saveVoucherData()">Save</button>
									                <button type="button" class="btn btn-border"  data-dismiss="modal">Cancel</button>
						            </div>
			                    </form>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
			<!-- old modal <div class="modalView" id="VoucherRequestSuccess" tabindex="-1" role="dialog"
			       aria-labelledby="exampleModalCenterTitle" >
			       <div class="modal-dialog modal-dialog-centered" role="document">
			           <div class="modal-content modal-bulk">
			               <div class="modal-top text-center">
			                   <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="approvedClose" onclick="approvedClose()">
			                       <img src="img/modal-close.svg" alt="">
			                   </button>
			                   <img src="img/modal-success.svg" alt="">
			               </div>
			               <div class="modal-bottom">
			                   <div class="count"><span>4</span><strong>5</strong></div>-->
			                   <!--<br>
			                   <span>Data saved SuccessFully!</span>
			               </div>
			           </div>
			       </div>
			   </div>-->
			   
			   <div class="modalView" id="VoucherRequestSuccess">
			   		        <div class="modal-dialog modal-dialog-centered">
			   		            <div class="modal-content modal-bulk p-0">
			   		                <div class="modal-top text-center">
			   		                    <button type="button" class="close p-0"  data-dismiss="modal" id="approvedClose" onclick="approvedClose()" aria-label="Close" style="right: 10px; top: 0;">
			   		                        <img src="img/modal-close.svg" alt="">
			   		                    </button>
			   		                    <img src="img/modal-success.svg" alt="">
			   		                </div>
			   		                <div class="modal-bottom">
			   		                   <span>Data saved SuccessFully!</span>
			   		                </div>
			   		            </div>
			   		        </div>
			   		    </div>
</body>

</body>

</html>